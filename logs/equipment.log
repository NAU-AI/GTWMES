2025-03-05 23:23:35,517 - INFO - Initializing MQTT connection...
2025-03-05 23:23:35,717 - INFO - Starting periodic message service...
2025-03-05 23:23:35,733 - INFO - Started periodic message sending thread.
2025-03-05 23:23:35,750 - INFO - Starting heartbeat monitoring...
2025-03-05 23:23:35,751 - INFO - Starting heartbeat monitor thread.
2025-03-05 23:23:35,751 - INFO - Heartbeat monitoring started.
2025-03-05 23:23:35,754 - INFO - All equipment schedules initialized.
2025-03-05 23:23:35,754 - INFO - Starting MQTT client loop...
2025-03-05 23:23:35,789 - INFO - Initialized heartbeat tracking for MAQ01.
2025-03-05 23:23:36,799 - INFO - Configuration updated for MAQ01. New cycle = 2s
2025-03-05 23:23:37,767 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:24:02,778 - ERROR - Error fetching latest active time record for equipment ID '1': (psycopg2.errors.UndefinedColumn) column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-03-05 23:24:02,789 - ERROR - Error fetching active time record for equipment ID '1': Unable to fetch latest active time record.
Traceback (most recent call last):
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.
2025-03-05 23:24:02,795 - ERROR - Error fetching alarm records for equipment ID '1': (psycopg2.errors.UndefinedColumn) column alarm_record.variable_id does not exist
LINE 2: FROM alarm_record JOIN variable ON variable.id = alarm_recor...
                                                         ^
HINT:  Perhaps you meant to reference the column "alarm_record.variable".

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column alarm_record.variable_id does not exist
LINE 2: FROM alarm_record JOIN variable ON variable.id = alarm_recor...
                                                         ^
HINT:  Perhaps you meant to reference the column "alarm_record.variable".


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column alarm_record.variable_id does not exist
LINE 2: FROM alarm_record JOIN variable ON variable.id = alarm_recor...
                                                         ^
HINT:  Perhaps you meant to reference the column "alarm_record.variable".

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-03-05 23:24:02,798 - ERROR - Error building production count message: Unable to fetch alarm records.
Traceback (most recent call last):
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column alarm_record.variable_id does not exist
LINE 2: FROM alarm_record JOIN variable ON variable.id = alarm_recor...
                                                         ^
HINT:  Perhaps you meant to reference the column "alarm_record.variable".


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column alarm_record.variable_id does not exist
LINE 2: FROM alarm_record JOIN variable ON variable.id = alarm_recor...
                                                         ^
HINT:  Perhaps you meant to reference the column "alarm_record.variable".

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 53, in build_production_count
    alarms = self.alarm_service.get_by_equipment_id(equipment.id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 44, in get_by_equipment_id
    raise ServiceException("Unable to fetch alarm records.") from e
exception.Exception.ServiceException: Unable to fetch alarm records.
2025-03-05 23:24:02,802 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column alarm_record.variable_id does not exist
LINE 2: FROM alarm_record JOIN variable ON variable.id = alarm_recor...
                                                         ^
HINT:  Perhaps you meant to reference the column "alarm_record.variable".


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column alarm_record.variable_id does not exist
LINE 2: FROM alarm_record JOIN variable ON variable.id = alarm_recor...
                                                         ^
HINT:  Perhaps you meant to reference the column "alarm_record.variable".

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 53, in build_production_count
    alarms = self.alarm_service.get_by_equipment_id(equipment.id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 44, in get_by_equipment_id
    raise ServiceException("Unable to fetch alarm records.") from e
exception.Exception.ServiceException: Unable to fetch alarm records.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:24:02,838 - ERROR - ALARM TRIGGERED: Heartbeat timeout for MAQ01. Elapsed = 27.05s, Timeout = 11s
2025-03-05 23:24:02,839 - WARNING - PLC client connection failed.
2025-03-05 23:24:02,839 - ERROR - Failed to connect to PLC. Cannot write alarm data.
2025-03-05 23:24:02,839 - WARNING - Alarm written to PLC for MAQ01: Byte 8, Bit 0, Value 1
2025-03-05 23:24:04,808 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:32:46,938 - ERROR - Error fetching alarm records for equipment ID '1': (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-03-05 23:32:46,941 - ERROR - Error building production count message: Unable to fetch alarm records.
Traceback (most recent call last):
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 53, in build_production_count
    alarms = self.alarm_service.get_by_equipment_id(equipment.id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 44, in get_by_equipment_id
    raise ServiceException("Unable to fetch alarm records.") from e
exception.Exception.ServiceException: Unable to fetch alarm records.
2025-03-05 23:32:46,944 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 53, in build_production_count
    alarms = self.alarm_service.get_by_equipment_id(equipment.id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 44, in get_by_equipment_id
    raise ServiceException("Unable to fetch alarm records.") from e
exception.Exception.ServiceException: Unable to fetch alarm records.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
