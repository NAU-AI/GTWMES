2025-03-05 22:59:32,336 - ERROR - Critical startup failure: Protocol.get_jsonType() missing 1 required positional argument: 'handler'
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\main.py", line 56, in main
    mes_service = MESMain()
                  ^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\main.py", line 16, in __init__
    self.message_processor = message_processor or MessageProcessor()
                                                  ^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\MQTT\mqtt_message_processor.py", line 12, in __init__
    self.message_handler = message_handler or MessageHandler()
                                              ^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\MQTT\mqtt_message_handler.py", line 17, in __init__
    self.protocols = Protocol.get_jsonType()
                     ^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Protocol.get_jsonType() missing 1 required positional argument: 'handler'
2025-03-05 23:03:05,592 - INFO - Initializing MQTT connection...
2025-03-05 23:03:05,792 - INFO - Starting periodic message service...
2025-03-05 23:03:05,794 - INFO - Started periodic message sending thread.
2025-03-05 23:03:05,795 - INFO - Starting heartbeat monitoring...
2025-03-05 23:03:05,795 - INFO - Starting heartbeat monitor thread.
2025-03-05 23:03:05,796 - INFO - Heartbeat monitoring started.
2025-03-05 23:03:05,796 - INFO - Starting MQTT client loop...
2025-03-05 23:03:05,794 - ERROR - Error fetching all equipment.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2522, in get_property
    return self._props[key]
           ~~~~~~~~~~~^^^^^
KeyError: 'equipment'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\equipment_service.py", line 57, in get_all_equipment
    return self.equipment_dao.find_all()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\equipment_dao.py", line 18, in find_all
    return self.session.query(Equipment).all()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2955, in query
    return self._query_cls(entities, self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 275, in __init__
    self._set_entities(entities)
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 288, in _set_entities
    coercions.expect(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\coercions.py", line 388, in expect
    insp._post_inspect
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1257, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2724, in _post_inspect
    self._check_configure()
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4213, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4254, in _do_configure_registries
    mapper._post_configure_properties()
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2418, in _post_configure_properties
    prop.init()
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\interfaces.py", line 589, in init
    self.do_init()
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\relationships.py", line 1661, in do_init
    self._generate_backref()
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\relationships.py", line 2147, in _generate_backref
    self._add_reverse_property(self.back_populates)
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\relationships.py", line 1592, in _add_reverse_property
    other = self.mapper.get_property(key, _configure_mappers=False)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2524, in get_property
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: Mapper 'Mapper[Variable(variable)]' has no property 'equipment'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-03-05 23:03:05,796 - ERROR - Error fetching all equipment.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\equipment_service.py", line 57, in get_all_equipment
    return self.equipment_dao.find_all()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\equipment_dao.py", line 18, in find_all
    return self.session.query(Equipment).all()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2955, in query
    return self._query_cls(entities, self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 275, in __init__
    self._set_entities(entities)
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 288, in _set_entities
    coercions.expect(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\coercions.py", line 388, in expect
    insp._post_inspect
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1257, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2724, in _post_inspect
    self._check_configure()
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4213, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4250, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Equipment(equipment)]'. Original exception was: Mapper 'Mapper[Variable(variable)]' has no property 'equipment'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-03-05 23:03:05,892 - ERROR - Error executing production count: Unable to fetch all equipment.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2522, in get_property
    return self._props[key]
           ~~~~~~~~~~~^^^^^
KeyError: 'equipment'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\equipment_service.py", line 57, in get_all_equipment
    return self.equipment_dao.find_all()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\equipment_dao.py", line 18, in find_all
    return self.session.query(Equipment).all()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2955, in query
    return self._query_cls(entities, self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 275, in __init__
    self._set_entities(entities)
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 288, in _set_entities
    coercions.expect(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\coercions.py", line 388, in expect
    insp._post_inspect
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1257, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2724, in _post_inspect
    self._check_configure()
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4213, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4254, in _do_configure_registries
    mapper._post_configure_properties()
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2418, in _post_configure_properties
    prop.init()
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\interfaces.py", line 589, in init
    self.do_init()
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\relationships.py", line 1661, in do_init
    self._generate_backref()
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\relationships.py", line 2147, in _generate_backref
    self._add_reverse_property(self.back_populates)
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\relationships.py", line 1592, in _add_reverse_property
    other = self.mapper.get_property(key, _configure_mappers=False)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2524, in get_property
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: Mapper 'Mapper[Variable(variable)]' has no property 'equipment'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 31, in execute_production_count
    equipments = self.equipment_service.get_all_equipment()
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\equipment_service.py", line 60, in get_all_equipment
    raise ServiceException("Unable to fetch all equipment.") from e
exception.Exception.ServiceException: Unable to fetch all equipment.
2025-03-05 23:03:05,892 - ERROR - Unexpected error in heartbeat monitor: Unable to fetch all equipment.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\equipment_service.py", line 57, in get_all_equipment
    return self.equipment_dao.find_all()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\equipment_dao.py", line 18, in find_all
    return self.session.query(Equipment).all()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2955, in query
    return self._query_cls(entities, self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 275, in __init__
    self._set_entities(entities)
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 288, in _set_entities
    coercions.expect(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\coercions.py", line 388, in expect
    insp._post_inspect
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1257, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2724, in _post_inspect
    self._check_configure()
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4213, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4250, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Equipment(equipment)]'. Original exception was: Mapper 'Mapper[Variable(variable)]' has no property 'equipment'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\MQTT\mqtt_heart_beat.py", line 45, in monitor
    equipments = self.equipment_service.get_all_equipment()
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\equipment_service.py", line 60, in get_all_equipment
    raise ServiceException("Unable to fetch all equipment.") from e
exception.Exception.ServiceException: Unable to fetch all equipment.
2025-03-05 23:04:59,480 - INFO - Initializing MQTT connection...
2025-03-05 23:04:59,670 - INFO - Starting periodic message service...
2025-03-05 23:04:59,675 - INFO - Started periodic message sending thread.
2025-03-05 23:04:59,696 - INFO - Starting heartbeat monitoring...
2025-03-05 23:04:59,696 - INFO - Starting heartbeat monitor thread.
2025-03-05 23:04:59,697 - WARNING - No equipment found for production count execution.
2025-03-05 23:04:59,697 - INFO - Heartbeat monitoring started.
2025-03-05 23:04:59,697 - INFO - Starting MQTT client loop...
2025-03-05 23:06:52,973 - INFO - Initializing MQTT connection...
2025-03-05 23:06:53,162 - INFO - Starting periodic message service...
2025-03-05 23:06:53,187 - INFO - Started periodic message sending thread.
2025-03-05 23:06:53,190 - INFO - Starting heartbeat monitoring...
2025-03-05 23:06:53,190 - INFO - Starting heartbeat monitor thread.
2025-03-05 23:06:53,191 - INFO - Heartbeat monitoring started.
2025-03-05 23:06:53,192 - INFO - All equipment schedules initialized.
2025-03-05 23:06:53,192 - INFO - Starting MQTT client loop...
2025-03-05 23:06:53,227 - INFO - Initialized heartbeat tracking for MAQ01.
2025-03-05 23:06:54,230 - INFO - Configuration updated for MAQ01. New cycle = 2s
2025-03-05 23:06:55,202 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:06:55,281 - ERROR - Error building production count message: 'ActiveTimeRecordService' object has no attribute 'get_active_record_time'
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'ActiveTimeRecordService' object has no attribute 'get_active_record_time'
2025-03-05 23:06:55,283 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'ActiveTimeRecordService' object has no attribute 'get_active_record_time'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:06:57,292 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:06:57,294 - ERROR - Error building production count message: 'ActiveTimeRecordService' object has no attribute 'get_active_record_time'
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'ActiveTimeRecordService' object has no attribute 'get_active_record_time'
2025-03-05 23:06:57,295 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'ActiveTimeRecordService' object has no attribute 'get_active_record_time'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:06:59,300 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:06:59,301 - ERROR - Error building production count message: 'ActiveTimeRecordService' object has no attribute 'get_active_record_time'
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'ActiveTimeRecordService' object has no attribute 'get_active_record_time'
2025-03-05 23:06:59,302 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'ActiveTimeRecordService' object has no attribute 'get_active_record_time'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:07:01,312 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:07:01,314 - ERROR - Error building production count message: 'ActiveTimeRecordService' object has no attribute 'get_active_record_time'
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'ActiveTimeRecordService' object has no attribute 'get_active_record_time'
2025-03-05 23:07:01,315 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'ActiveTimeRecordService' object has no attribute 'get_active_record_time'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:07:03,330 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:07:03,332 - ERROR - Error building production count message: 'ActiveTimeRecordService' object has no attribute 'get_active_record_time'
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'ActiveTimeRecordService' object has no attribute 'get_active_record_time'
2025-03-05 23:07:03,333 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'ActiveTimeRecordService' object has no attribute 'get_active_record_time'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:07:04,240 - ERROR - ALARM TRIGGERED: Heartbeat timeout for MAQ01. Elapsed = 11.01s, Timeout = 11s
2025-03-05 23:07:04,241 - WARNING - PLC client connection failed.
2025-03-05 23:07:04,242 - ERROR - Failed to connect to PLC. Cannot write alarm data.
2025-03-05 23:07:04,242 - WARNING - Alarm written to PLC for MAQ01: Byte 8, Bit 0, Value 1
2025-03-05 23:07:05,342 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:07:05,344 - ERROR - Error building production count message: 'ActiveTimeRecordService' object has no attribute 'get_active_record_time'
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'ActiveTimeRecordService' object has no attribute 'get_active_record_time'
2025-03-05 23:07:05,346 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'ActiveTimeRecordService' object has no attribute 'get_active_record_time'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:12:16,644 - INFO - Initializing MQTT connection...
2025-03-05 23:12:16,872 - INFO - Starting periodic message service...
2025-03-05 23:12:16,895 - INFO - Started periodic message sending thread.
2025-03-05 23:12:16,898 - INFO - Starting heartbeat monitoring...
2025-03-05 23:12:16,899 - INFO - Starting heartbeat monitor thread.
2025-03-05 23:12:16,900 - INFO - Heartbeat monitoring started.
2025-03-05 23:12:16,900 - INFO - All equipment schedules initialized.
2025-03-05 23:12:16,901 - INFO - Starting MQTT client loop...
2025-03-05 23:12:16,938 - INFO - Initialized heartbeat tracking for MAQ01.
2025-03-05 23:12:17,940 - INFO - Configuration updated for MAQ01. New cycle = 2s
2025-03-05 23:12:18,913 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:12:19,031 - ERROR - Error fetching latest active time record for equipment ID '1': (psycopg2.errors.UndefinedColumn) column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    if record := self.active_time_record_dao.find_latest_by_equipment_id(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-03-05 23:12:19,077 - ERROR - Error fetching active time record for equipment ID '1': Unable to fetch latest active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    if record := self.active_time_record_dao.find_latest_by_equipment_id(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 88, in get_active_record_time
    record = self.get_latest_by_equipment_id(equipment_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 84, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.
2025-03-05 23:12:19,081 - ERROR - Error building production count message: Unable to fetch active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    if record := self.active_time_record_dao.find_latest_by_equipment_id(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 88, in get_active_record_time
    record = self.get_latest_by_equipment_id(equipment_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 84, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 100, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.
2025-03-05 23:12:19,084 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    if record := self.active_time_record_dao.find_latest_by_equipment_id(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 88, in get_active_record_time
    record = self.get_latest_by_equipment_id(equipment_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 84, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 100, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:12:21,101 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:12:21,104 - ERROR - Error fetching latest active time record for equipment ID '1': (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    if record := self.active_time_record_dao.find_latest_by_equipment_id(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-03-05 23:12:21,106 - ERROR - Error fetching active time record for equipment ID '1': Unable to fetch latest active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    if record := self.active_time_record_dao.find_latest_by_equipment_id(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 88, in get_active_record_time
    record = self.get_latest_by_equipment_id(equipment_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 84, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.
2025-03-05 23:12:21,109 - ERROR - Error building production count message: Unable to fetch active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    if record := self.active_time_record_dao.find_latest_by_equipment_id(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 88, in get_active_record_time
    record = self.get_latest_by_equipment_id(equipment_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 84, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 100, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.
2025-03-05 23:12:21,112 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    if record := self.active_time_record_dao.find_latest_by_equipment_id(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 88, in get_active_record_time
    record = self.get_latest_by_equipment_id(equipment_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 84, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 100, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:12:23,118 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:12:23,120 - ERROR - Error fetching latest active time record for equipment ID '1': (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    if record := self.active_time_record_dao.find_latest_by_equipment_id(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-03-05 23:12:23,122 - ERROR - Error fetching active time record for equipment ID '1': Unable to fetch latest active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    if record := self.active_time_record_dao.find_latest_by_equipment_id(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 88, in get_active_record_time
    record = self.get_latest_by_equipment_id(equipment_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 84, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.
2025-03-05 23:12:23,125 - ERROR - Error building production count message: Unable to fetch active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    if record := self.active_time_record_dao.find_latest_by_equipment_id(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 88, in get_active_record_time
    record = self.get_latest_by_equipment_id(equipment_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 84, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 100, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.
2025-03-05 23:12:23,129 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    if record := self.active_time_record_dao.find_latest_by_equipment_id(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 88, in get_active_record_time
    record = self.get_latest_by_equipment_id(equipment_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 84, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 100, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:12:25,144 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:12:25,147 - ERROR - Error fetching latest active time record for equipment ID '1': (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    if record := self.active_time_record_dao.find_latest_by_equipment_id(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-03-05 23:12:25,150 - ERROR - Error fetching active time record for equipment ID '1': Unable to fetch latest active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    if record := self.active_time_record_dao.find_latest_by_equipment_id(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 88, in get_active_record_time
    record = self.get_latest_by_equipment_id(equipment_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 84, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.
2025-03-05 23:12:25,153 - ERROR - Error building production count message: Unable to fetch active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    if record := self.active_time_record_dao.find_latest_by_equipment_id(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 88, in get_active_record_time
    record = self.get_latest_by_equipment_id(equipment_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 84, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 100, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.
2025-03-05 23:12:25,156 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    if record := self.active_time_record_dao.find_latest_by_equipment_id(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 88, in get_active_record_time
    record = self.get_latest_by_equipment_id(equipment_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 84, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 100, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:12:27,161 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:12:27,163 - ERROR - Error fetching latest active time record for equipment ID '1': (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    if record := self.active_time_record_dao.find_latest_by_equipment_id(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-03-05 23:12:27,165 - ERROR - Error fetching active time record for equipment ID '1': Unable to fetch latest active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    if record := self.active_time_record_dao.find_latest_by_equipment_id(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 88, in get_active_record_time
    record = self.get_latest_by_equipment_id(equipment_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 84, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.
2025-03-05 23:12:27,167 - ERROR - Error building production count message: Unable to fetch active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    if record := self.active_time_record_dao.find_latest_by_equipment_id(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 88, in get_active_record_time
    record = self.get_latest_by_equipment_id(equipment_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 84, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 100, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.
2025-03-05 23:12:27,170 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    if record := self.active_time_record_dao.find_latest_by_equipment_id(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 88, in get_active_record_time
    record = self.get_latest_by_equipment_id(equipment_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 84, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 100, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:12:27,954 - ERROR - ALARM TRIGGERED: Heartbeat timeout for MAQ01. Elapsed = 11.02s, Timeout = 11s
2025-03-05 23:12:27,955 - WARNING - PLC client connection failed.
2025-03-05 23:12:27,955 - ERROR - Failed to connect to PLC. Cannot write alarm data.
2025-03-05 23:12:27,955 - WARNING - Alarm written to PLC for MAQ01: Byte 8, Bit 0, Value 1
2025-03-05 23:12:29,175 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:12:29,177 - ERROR - Error fetching latest active time record for equipment ID '1': (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    if record := self.active_time_record_dao.find_latest_by_equipment_id(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-03-05 23:12:29,180 - ERROR - Error fetching active time record for equipment ID '1': Unable to fetch latest active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    if record := self.active_time_record_dao.find_latest_by_equipment_id(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 88, in get_active_record_time
    record = self.get_latest_by_equipment_id(equipment_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 84, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.
2025-03-05 23:12:29,182 - ERROR - Error building production count message: Unable to fetch active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    if record := self.active_time_record_dao.find_latest_by_equipment_id(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 88, in get_active_record_time
    record = self.get_latest_by_equipment_id(equipment_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 84, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 100, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.
2025-03-05 23:12:29,186 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    if record := self.active_time_record_dao.find_latest_by_equipment_id(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 88, in get_active_record_time
    record = self.get_latest_by_equipment_id(equipment_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 84, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 100, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:12:31,190 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:12:31,192 - ERROR - Error fetching latest active time record for equipment ID '1': (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    if record := self.active_time_record_dao.find_latest_by_equipment_id(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-03-05 23:12:31,195 - ERROR - Error fetching active time record for equipment ID '1': Unable to fetch latest active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    if record := self.active_time_record_dao.find_latest_by_equipment_id(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 88, in get_active_record_time
    record = self.get_latest_by_equipment_id(equipment_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 84, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.
2025-03-05 23:12:31,197 - ERROR - Error building production count message: Unable to fetch active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    if record := self.active_time_record_dao.find_latest_by_equipment_id(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 88, in get_active_record_time
    record = self.get_latest_by_equipment_id(equipment_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 84, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 100, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.
2025-03-05 23:12:31,200 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    if record := self.active_time_record_dao.find_latest_by_equipment_id(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 88, in get_active_record_time
    record = self.get_latest_by_equipment_id(equipment_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 84, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 100, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:16:31,067 - INFO - Initializing MQTT connection...
2025-03-05 23:16:31,284 - INFO - Starting periodic message service...
2025-03-05 23:16:31,308 - INFO - Started periodic message sending thread.
2025-03-05 23:16:31,311 - INFO - Starting heartbeat monitoring...
2025-03-05 23:16:31,311 - INFO - Starting heartbeat monitor thread.
2025-03-05 23:16:31,313 - INFO - Heartbeat monitoring started.
2025-03-05 23:16:31,313 - INFO - All equipment schedules initialized.
2025-03-05 23:16:31,314 - INFO - Starting MQTT client loop...
2025-03-05 23:16:31,350 - INFO - Initialized heartbeat tracking for MAQ01.
2025-03-05 23:16:32,352 - INFO - Configuration updated for MAQ01. New cycle = 2s
2025-03-05 23:16:33,321 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:16:33,434 - ERROR - Error fetching latest active time record for equipment ID '1': (psycopg2.errors.UndefinedColumn) column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-03-05 23:16:33,441 - ERROR - Error fetching active time record for equipment ID '1': Unable to fetch latest active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.
2025-03-05 23:16:33,444 - ERROR - Error building production count message: Unable to fetch active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.
2025-03-05 23:16:33,448 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:16:35,455 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:16:35,457 - ERROR - Error fetching latest active time record for equipment ID '1': (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-03-05 23:16:35,460 - ERROR - Error fetching active time record for equipment ID '1': Unable to fetch latest active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.
2025-03-05 23:16:35,463 - ERROR - Error building production count message: Unable to fetch active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.
2025-03-05 23:16:35,466 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:16:37,480 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:16:37,483 - ERROR - Error fetching latest active time record for equipment ID '1': (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-03-05 23:16:37,485 - ERROR - Error fetching active time record for equipment ID '1': Unable to fetch latest active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.
2025-03-05 23:16:37,488 - ERROR - Error building production count message: Unable to fetch active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.
2025-03-05 23:16:37,490 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:16:39,504 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:16:39,506 - ERROR - Error fetching latest active time record for equipment ID '1': (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-03-05 23:16:39,509 - ERROR - Error fetching active time record for equipment ID '1': Unable to fetch latest active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.
2025-03-05 23:16:39,512 - ERROR - Error building production count message: Unable to fetch active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.
2025-03-05 23:16:39,514 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:16:41,531 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:16:41,533 - ERROR - Error fetching latest active time record for equipment ID '1': (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-03-05 23:16:41,536 - ERROR - Error fetching active time record for equipment ID '1': Unable to fetch latest active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.
2025-03-05 23:16:41,538 - ERROR - Error building production count message: Unable to fetch active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.
2025-03-05 23:16:41,540 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:16:42,365 - ERROR - ALARM TRIGGERED: Heartbeat timeout for MAQ01. Elapsed = 11.01s, Timeout = 11s
2025-03-05 23:16:42,366 - WARNING - PLC client connection failed.
2025-03-05 23:16:42,366 - ERROR - Failed to connect to PLC. Cannot write alarm data.
2025-03-05 23:16:42,366 - WARNING - Alarm written to PLC for MAQ01: Byte 8, Bit 0, Value 1
2025-03-05 23:16:43,556 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:16:43,558 - ERROR - Error fetching latest active time record for equipment ID '1': (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-03-05 23:16:43,561 - ERROR - Error fetching active time record for equipment ID '1': Unable to fetch latest active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.
2025-03-05 23:16:43,564 - ERROR - Error building production count message: Unable to fetch active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.
2025-03-05 23:16:43,566 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:16:45,572 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:16:45,575 - ERROR - Error fetching latest active time record for equipment ID '1': (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-03-05 23:16:45,578 - ERROR - Error fetching active time record for equipment ID '1': Unable to fetch latest active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.
2025-03-05 23:16:45,580 - ERROR - Error building production count message: Unable to fetch active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.
2025-03-05 23:16:45,582 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:16:47,586 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:16:47,589 - ERROR - Error fetching latest active time record for equipment ID '1': (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-03-05 23:16:47,592 - ERROR - Error fetching active time record for equipment ID '1': Unable to fetch latest active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.
2025-03-05 23:16:47,595 - ERROR - Error building production count message: Unable to fetch active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.
2025-03-05 23:16:47,599 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:16:49,607 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:16:49,610 - ERROR - Error fetching latest active time record for equipment ID '1': (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-03-05 23:16:49,613 - ERROR - Error fetching active time record for equipment ID '1': Unable to fetch latest active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.
2025-03-05 23:16:49,615 - ERROR - Error building production count message: Unable to fetch active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.
2025-03-05 23:16:49,618 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:16:51,626 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:16:51,628 - ERROR - Error fetching latest active time record for equipment ID '1': (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-03-05 23:16:51,630 - ERROR - Error fetching active time record for equipment ID '1': Unable to fetch latest active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.
2025-03-05 23:16:51,633 - ERROR - Error building production count message: Unable to fetch active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.
2025-03-05 23:16:51,635 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:16:53,641 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:16:53,643 - ERROR - Error fetching latest active time record for equipment ID '1': (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-03-05 23:16:53,646 - ERROR - Error fetching active time record for equipment ID '1': Unable to fetch latest active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.
2025-03-05 23:16:53,649 - ERROR - Error building production count message: Unable to fetch active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.
2025-03-05 23:16:53,652 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:16:55,658 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:16:55,660 - ERROR - Error fetching latest active time record for equipment ID '1': (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-03-05 23:16:55,663 - ERROR - Error fetching active time record for equipment ID '1': Unable to fetch latest active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.
2025-03-05 23:16:55,666 - ERROR - Error building production count message: Unable to fetch active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.
2025-03-05 23:16:55,668 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:16:57,676 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:16:57,678 - ERROR - Error fetching latest active time record for equipment ID '1': (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-03-05 23:16:57,680 - ERROR - Error fetching active time record for equipment ID '1': Unable to fetch latest active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.
2025-03-05 23:16:57,683 - ERROR - Error building production count message: Unable to fetch active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.
2025-03-05 23:16:57,685 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:16:59,694 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:16:59,697 - ERROR - Error fetching latest active time record for equipment ID '1': (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-03-05 23:16:59,699 - ERROR - Error fetching active time record for equipment ID '1': Unable to fetch latest active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.
2025-03-05 23:16:59,702 - ERROR - Error building production count message: Unable to fetch active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.
2025-03-05 23:16:59,705 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:17:01,716 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:17:01,719 - ERROR - Error fetching latest active time record for equipment ID '1': (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-03-05 23:17:01,721 - ERROR - Error fetching active time record for equipment ID '1': Unable to fetch latest active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.
2025-03-05 23:17:01,724 - ERROR - Error building production count message: Unable to fetch active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.
2025-03-05 23:17:01,727 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:17:03,734 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:17:03,737 - ERROR - Error fetching latest active time record for equipment ID '1': (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-03-05 23:17:03,739 - ERROR - Error fetching active time record for equipment ID '1': Unable to fetch latest active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.
2025-03-05 23:17:03,743 - ERROR - Error building production count message: Unable to fetch active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.
2025-03-05 23:17:03,745 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:17:05,751 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:17:05,754 - ERROR - Error fetching latest active time record for equipment ID '1': (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-03-05 23:17:05,757 - ERROR - Error fetching active time record for equipment ID '1': Unable to fetch latest active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.
2025-03-05 23:17:05,759 - ERROR - Error building production count message: Unable to fetch active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.
2025-03-05 23:17:05,762 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:17:07,770 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:19:04,409 - INFO - Initializing MQTT connection...
2025-03-05 23:19:04,640 - INFO - Starting periodic message service...
2025-03-05 23:19:04,665 - INFO - Started periodic message sending thread.
2025-03-05 23:19:04,669 - INFO - Starting heartbeat monitoring...
2025-03-05 23:19:04,669 - INFO - Starting heartbeat monitor thread.
2025-03-05 23:19:04,669 - INFO - Heartbeat monitoring started.
2025-03-05 23:19:04,669 - INFO - All equipment schedules initialized.
2025-03-05 23:19:04,671 - INFO - Starting MQTT client loop...
2025-03-05 23:19:04,708 - INFO - Initialized heartbeat tracking for MAQ01.
2025-03-05 23:19:05,710 - INFO - Configuration updated for MAQ01. New cycle = 2s
2025-03-05 23:19:06,671 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:19:06,789 - ERROR - Error fetching latest active time record for equipment ID '1': (psycopg2.errors.UndefinedColumn) column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-03-05 23:19:06,797 - ERROR - Error fetching active time record for equipment ID '1': Unable to fetch latest active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.
2025-03-05 23:19:06,800 - ERROR - Error building production count message: Unable to fetch active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.
2025-03-05 23:19:06,803 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:19:08,819 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:19:08,822 - ERROR - Error fetching latest active time record for equipment ID '1': (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-03-05 23:19:08,824 - ERROR - Error fetching active time record for equipment ID '1': Unable to fetch latest active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.
2025-03-05 23:19:08,826 - ERROR - Error building production count message: Unable to fetch active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.
2025-03-05 23:19:08,829 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:19:10,836 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:19:10,839 - ERROR - Error fetching latest active time record for equipment ID '1': (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-03-05 23:19:10,842 - ERROR - Error fetching active time record for equipment ID '1': Unable to fetch latest active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.
2025-03-05 23:19:10,844 - ERROR - Error building production count message: Unable to fetch active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.
2025-03-05 23:19:10,847 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:19:12,866 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:19:12,869 - ERROR - Error fetching latest active time record for equipment ID '1': (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-03-05 23:19:12,871 - ERROR - Error fetching active time record for equipment ID '1': Unable to fetch latest active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.
2025-03-05 23:19:12,874 - ERROR - Error building production count message: Unable to fetch active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.
2025-03-05 23:19:12,876 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:19:14,881 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:19:14,884 - ERROR - Error fetching latest active time record for equipment ID '1': (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-03-05 23:19:14,886 - ERROR - Error fetching active time record for equipment ID '1': Unable to fetch latest active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.
2025-03-05 23:19:14,889 - ERROR - Error building production count message: Unable to fetch active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.
2025-03-05 23:19:14,891 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:19:15,722 - ERROR - ALARM TRIGGERED: Heartbeat timeout for MAQ01. Elapsed = 11.01s, Timeout = 11s
2025-03-05 23:19:15,723 - WARNING - PLC client connection failed.
2025-03-05 23:19:15,723 - ERROR - Failed to connect to PLC. Cannot write alarm data.
2025-03-05 23:19:15,723 - WARNING - Alarm written to PLC for MAQ01: Byte 8, Bit 0, Value 1
2025-03-05 23:19:16,897 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:19:16,901 - ERROR - Error fetching latest active time record for equipment ID '1': (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-03-05 23:19:16,903 - ERROR - Error fetching active time record for equipment ID '1': Unable to fetch latest active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.
2025-03-05 23:19:16,907 - ERROR - Error building production count message: Unable to fetch active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.
2025-03-05 23:19:16,909 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 52, in build_production_count
    active_time = self.active_time_service.get_active_record_time(equipment.id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 98, in get_active_record_time
    raise ServiceException("Unable to fetch active time record.") from e
exception.Exception.ServiceException: Unable to fetch active time record.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:19:18,915 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:19:18,919 - ERROR - Error fetching latest active time record for equipment ID '1': (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-03-05 23:21:26,599 - INFO - Initializing MQTT connection...
2025-03-05 23:21:26,808 - INFO - Starting periodic message service...
2025-03-05 23:21:26,829 - INFO - Started periodic message sending thread.
2025-03-05 23:21:26,833 - INFO - Starting heartbeat monitoring...
2025-03-05 23:21:26,833 - INFO - Starting heartbeat monitor thread.
2025-03-05 23:21:26,834 - INFO - Heartbeat monitoring started.
2025-03-05 23:21:26,834 - INFO - All equipment schedules initialized.
2025-03-05 23:21:26,834 - INFO - Starting MQTT client loop...
2025-03-05 23:21:26,874 - INFO - Initialized heartbeat tracking for MAQ01.
2025-03-05 23:21:27,876 - INFO - Configuration updated for MAQ01. New cycle = 2s
2025-03-05 23:21:28,844 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:21:28,962 - ERROR - Error fetching latest active time record for equipment ID '1': (psycopg2.errors.UndefinedColumn) column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-03-05 23:21:28,969 - ERROR - Error fetching active time record for equipment ID '1': Unable to fetch latest active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.
2025-03-05 23:21:28,974 - ERROR - Error fetching alarm records for equipment ID '1': (psycopg2.errors.UndefinedColumn) column alarm_record.variable_id does not exist
LINE 2: FROM alarm_record JOIN variable ON variable.id = alarm_recor...
                                                         ^
HINT:  Perhaps you meant to reference the column "alarm_record.variable".

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column alarm_record.variable_id does not exist
LINE 2: FROM alarm_record JOIN variable ON variable.id = alarm_recor...
                                                         ^
HINT:  Perhaps you meant to reference the column "alarm_record.variable".


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column alarm_record.variable_id does not exist
LINE 2: FROM alarm_record JOIN variable ON variable.id = alarm_recor...
                                                         ^
HINT:  Perhaps you meant to reference the column "alarm_record.variable".

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-03-05 23:21:28,978 - ERROR - Error building production count message: Unable to fetch alarm records.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column alarm_record.variable_id does not exist
LINE 2: FROM alarm_record JOIN variable ON variable.id = alarm_recor...
                                                         ^
HINT:  Perhaps you meant to reference the column "alarm_record.variable".


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column alarm_record.variable_id does not exist
LINE 2: FROM alarm_record JOIN variable ON variable.id = alarm_recor...
                                                         ^
HINT:  Perhaps you meant to reference the column "alarm_record.variable".

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 53, in build_production_count
    alarms = self.alarm_service.get_by_equipment_id(equipment.id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 44, in get_by_equipment_id
    raise ServiceException("Unable to fetch alarm records.") from e
exception.Exception.ServiceException: Unable to fetch alarm records.
2025-03-05 23:21:28,981 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column alarm_record.variable_id does not exist
LINE 2: FROM alarm_record JOIN variable ON variable.id = alarm_recor...
                                                         ^
HINT:  Perhaps you meant to reference the column "alarm_record.variable".


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column alarm_record.variable_id does not exist
LINE 2: FROM alarm_record JOIN variable ON variable.id = alarm_recor...
                                                         ^
HINT:  Perhaps you meant to reference the column "alarm_record.variable".

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 53, in build_production_count
    alarms = self.alarm_service.get_by_equipment_id(equipment.id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 44, in get_by_equipment_id
    raise ServiceException("Unable to fetch alarm records.") from e
exception.Exception.ServiceException: Unable to fetch alarm records.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:21:30,999 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:21:31,038 - ERROR - Error fetching latest active time record for equipment ID '1': (psycopg2.errors.UndefinedColumn) column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-03-05 23:21:31,042 - ERROR - Error fetching active time record for equipment ID '1': Unable to fetch latest active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.
2025-03-05 23:21:31,046 - ERROR - Error fetching alarm records for equipment ID '1': (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-03-05 23:21:31,048 - ERROR - Error building production count message: Unable to fetch alarm records.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 53, in build_production_count
    alarms = self.alarm_service.get_by_equipment_id(equipment.id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 44, in get_by_equipment_id
    raise ServiceException("Unable to fetch alarm records.") from e
exception.Exception.ServiceException: Unable to fetch alarm records.
2025-03-05 23:21:31,051 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 53, in build_production_count
    alarms = self.alarm_service.get_by_equipment_id(equipment.id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 44, in get_by_equipment_id
    raise ServiceException("Unable to fetch alarm records.") from e
exception.Exception.ServiceException: Unable to fetch alarm records.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:21:33,056 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:21:33,058 - ERROR - Error fetching latest active time record for equipment ID '1': (psycopg2.errors.UndefinedColumn) column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-03-05 23:21:33,060 - ERROR - Error fetching active time record for equipment ID '1': Unable to fetch latest active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.
2025-03-05 23:21:33,064 - ERROR - Error fetching alarm records for equipment ID '1': (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-03-05 23:21:33,068 - ERROR - Error building production count message: Unable to fetch alarm records.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 53, in build_production_count
    alarms = self.alarm_service.get_by_equipment_id(equipment.id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 44, in get_by_equipment_id
    raise ServiceException("Unable to fetch alarm records.") from e
exception.Exception.ServiceException: Unable to fetch alarm records.
2025-03-05 23:21:33,070 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 53, in build_production_count
    alarms = self.alarm_service.get_by_equipment_id(equipment.id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 44, in get_by_equipment_id
    raise ServiceException("Unable to fetch alarm records.") from e
exception.Exception.ServiceException: Unable to fetch alarm records.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:21:35,080 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:21:35,082 - ERROR - Error fetching latest active time record for equipment ID '1': (psycopg2.errors.UndefinedColumn) column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-03-05 23:21:35,085 - ERROR - Error fetching active time record for equipment ID '1': Unable to fetch latest active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.
2025-03-05 23:21:35,091 - ERROR - Error fetching alarm records for equipment ID '1': (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-03-05 23:21:35,093 - ERROR - Error building production count message: Unable to fetch alarm records.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 53, in build_production_count
    alarms = self.alarm_service.get_by_equipment_id(equipment.id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 44, in get_by_equipment_id
    raise ServiceException("Unable to fetch alarm records.") from e
exception.Exception.ServiceException: Unable to fetch alarm records.
2025-03-05 23:21:35,096 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 53, in build_production_count
    alarms = self.alarm_service.get_by_equipment_id(equipment.id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 44, in get_by_equipment_id
    raise ServiceException("Unable to fetch alarm records.") from e
exception.Exception.ServiceException: Unable to fetch alarm records.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:21:37,108 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:21:37,112 - ERROR - Error fetching latest active time record for equipment ID '1': (psycopg2.errors.UndefinedColumn) column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-03-05 23:21:37,115 - ERROR - Error fetching active time record for equipment ID '1': Unable to fetch latest active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.
2025-03-05 23:21:37,118 - ERROR - Error fetching alarm records for equipment ID '1': (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-03-05 23:21:37,122 - ERROR - Error building production count message: Unable to fetch alarm records.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 53, in build_production_count
    alarms = self.alarm_service.get_by_equipment_id(equipment.id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 44, in get_by_equipment_id
    raise ServiceException("Unable to fetch alarm records.") from e
exception.Exception.ServiceException: Unable to fetch alarm records.
2025-03-05 23:21:37,125 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 53, in build_production_count
    alarms = self.alarm_service.get_by_equipment_id(equipment.id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 44, in get_by_equipment_id
    raise ServiceException("Unable to fetch alarm records.") from e
exception.Exception.ServiceException: Unable to fetch alarm records.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:21:37,889 - ERROR - ALARM TRIGGERED: Heartbeat timeout for MAQ01. Elapsed = 11.01s, Timeout = 11s
2025-03-05 23:21:37,891 - WARNING - PLC client connection failed.
2025-03-05 23:21:37,891 - ERROR - Failed to connect to PLC. Cannot write alarm data.
2025-03-05 23:21:37,891 - WARNING - Alarm written to PLC for MAQ01: Byte 8, Bit 0, Value 1
2025-03-05 23:21:39,142 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:21:39,144 - ERROR - Error fetching latest active time record for equipment ID '1': (psycopg2.errors.UndefinedColumn) column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-03-05 23:21:39,148 - ERROR - Error fetching active time record for equipment ID '1': Unable to fetch latest active time record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 70, in get_latest_by_equipment_id
    record = self.active_time_record_dao.find_latest_by_equipment_id(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\active_time_record_dao.py", line 60, in find_latest_by_equipment_id
    .first()
     ^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column active_time_record.variable_id does not exist
LINE 2: ...active_time_record JOIN variable ON variable.id = active_tim...
                                                             ^
HINT:  Perhaps you meant to reference the column "active_time_record.variable".

[SQL: SELECT active_time_record.id AS active_time_record_id, active_time_record.variable_id AS active_time_record_variable_id, active_time_record.active_time AS active_time_record_active_time, active_time_record.registered_at AS active_time_record_registered_at 
FROM active_time_record JOIN variable ON variable.id = active_time_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s ORDER BY active_time_record.registered_at DESC 
 LIMIT %(param_1)s]
[parameters: {'equipment_id_1': 1, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 87, in get_active_record_time
    return self.get_latest_by_equipment_id(equipment_id).active_time
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\active_time_record_service.py", line 83, in get_latest_by_equipment_id
    raise ServiceException("Unable to fetch latest active time record.") from e
exception.Exception.ServiceException: Unable to fetch latest active time record.
2025-03-05 23:21:39,150 - ERROR - Error fetching alarm records for equipment ID '1': (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-03-05 23:21:39,154 - ERROR - Error building production count message: Unable to fetch alarm records.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 53, in build_production_count
    alarms = self.alarm_service.get_by_equipment_id(equipment.id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 44, in get_by_equipment_id
    raise ServiceException("Unable to fetch alarm records.") from e
exception.Exception.ServiceException: Unable to fetch alarm records.
2025-03-05 23:21:39,156 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 53, in build_production_count
    alarms = self.alarm_service.get_by_equipment_id(equipment.id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 44, in get_by_equipment_id
    raise ServiceException("Unable to fetch alarm records.") from e
exception.Exception.ServiceException: Unable to fetch alarm records.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:33:06,356 - INFO - Initializing MQTT connection...
2025-03-05 23:33:06,574 - INFO - Starting periodic message service...
2025-03-05 23:33:06,597 - INFO - Started periodic message sending thread.
2025-03-05 23:33:06,600 - INFO - Starting heartbeat monitoring...
2025-03-05 23:33:06,600 - INFO - Starting heartbeat monitor thread.
2025-03-05 23:33:06,601 - INFO - Heartbeat monitoring started.
2025-03-05 23:33:06,601 - INFO - All equipment schedules initialized.
2025-03-05 23:33:06,602 - INFO - Starting MQTT client loop...
2025-03-05 23:33:06,642 - INFO - Initialized heartbeat tracking for MAQ01.
2025-03-05 23:33:07,644 - INFO - Configuration updated for MAQ01. New cycle = 2s
2025-03-05 23:33:08,609 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:33:08,761 - ERROR - Error fetching alarm records for equipment ID '1': (psycopg2.errors.UndefinedColumn) column alarm_record.variable_id does not exist
LINE 2: FROM alarm_record JOIN variable ON variable.id = alarm_recor...
                                                         ^
HINT:  Perhaps you meant to reference the column "alarm_record.variable".

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column alarm_record.variable_id does not exist
LINE 2: FROM alarm_record JOIN variable ON variable.id = alarm_recor...
                                                         ^
HINT:  Perhaps you meant to reference the column "alarm_record.variable".


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column alarm_record.variable_id does not exist
LINE 2: FROM alarm_record JOIN variable ON variable.id = alarm_recor...
                                                         ^
HINT:  Perhaps you meant to reference the column "alarm_record.variable".

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-03-05 23:33:08,770 - ERROR - Error building production count message: Unable to fetch alarm records.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column alarm_record.variable_id does not exist
LINE 2: FROM alarm_record JOIN variable ON variable.id = alarm_recor...
                                                         ^
HINT:  Perhaps you meant to reference the column "alarm_record.variable".


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column alarm_record.variable_id does not exist
LINE 2: FROM alarm_record JOIN variable ON variable.id = alarm_recor...
                                                         ^
HINT:  Perhaps you meant to reference the column "alarm_record.variable".

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 53, in build_production_count
    alarms = self.alarm_service.get_by_equipment_id(equipment.id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 44, in get_by_equipment_id
    raise ServiceException("Unable to fetch alarm records.") from e
exception.Exception.ServiceException: Unable to fetch alarm records.
2025-03-05 23:33:08,773 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column alarm_record.variable_id does not exist
LINE 2: FROM alarm_record JOIN variable ON variable.id = alarm_recor...
                                                         ^
HINT:  Perhaps you meant to reference the column "alarm_record.variable".


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column alarm_record.variable_id does not exist
LINE 2: FROM alarm_record JOIN variable ON variable.id = alarm_recor...
                                                         ^
HINT:  Perhaps you meant to reference the column "alarm_record.variable".

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 53, in build_production_count
    alarms = self.alarm_service.get_by_equipment_id(equipment.id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 44, in get_by_equipment_id
    raise ServiceException("Unable to fetch alarm records.") from e
exception.Exception.ServiceException: Unable to fetch alarm records.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:33:10,786 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:33:10,789 - ERROR - Error fetching alarm records for equipment ID '1': (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-03-05 23:33:10,793 - ERROR - Error building production count message: Unable to fetch alarm records.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 53, in build_production_count
    alarms = self.alarm_service.get_by_equipment_id(equipment.id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 44, in get_by_equipment_id
    raise ServiceException("Unable to fetch alarm records.") from e
exception.Exception.ServiceException: Unable to fetch alarm records.
2025-03-05 23:33:10,795 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 53, in build_production_count
    alarms = self.alarm_service.get_by_equipment_id(equipment.id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 44, in get_by_equipment_id
    raise ServiceException("Unable to fetch alarm records.") from e
exception.Exception.ServiceException: Unable to fetch alarm records.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:33:12,805 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:33:12,808 - ERROR - Error fetching alarm records for equipment ID '1': (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-03-05 23:33:12,811 - ERROR - Error building production count message: Unable to fetch alarm records.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 53, in build_production_count
    alarms = self.alarm_service.get_by_equipment_id(equipment.id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 44, in get_by_equipment_id
    raise ServiceException("Unable to fetch alarm records.") from e
exception.Exception.ServiceException: Unable to fetch alarm records.
2025-03-05 23:33:12,814 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 53, in build_production_count
    alarms = self.alarm_service.get_by_equipment_id(equipment.id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 44, in get_by_equipment_id
    raise ServiceException("Unable to fetch alarm records.") from e
exception.Exception.ServiceException: Unable to fetch alarm records.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:33:14,825 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:33:14,828 - ERROR - Error fetching alarm records for equipment ID '1': (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-03-05 23:33:14,832 - ERROR - Error building production count message: Unable to fetch alarm records.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 53, in build_production_count
    alarms = self.alarm_service.get_by_equipment_id(equipment.id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 44, in get_by_equipment_id
    raise ServiceException("Unable to fetch alarm records.") from e
exception.Exception.ServiceException: Unable to fetch alarm records.
2025-03-05 23:33:14,836 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 53, in build_production_count
    alarms = self.alarm_service.get_by_equipment_id(equipment.id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 44, in get_by_equipment_id
    raise ServiceException("Unable to fetch alarm records.") from e
exception.Exception.ServiceException: Unable to fetch alarm records.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:33:16,845 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:33:16,849 - ERROR - Error fetching alarm records for equipment ID '1': (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-03-05 23:33:16,852 - ERROR - Error building production count message: Unable to fetch alarm records.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 53, in build_production_count
    alarms = self.alarm_service.get_by_equipment_id(equipment.id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 44, in get_by_equipment_id
    raise ServiceException("Unable to fetch alarm records.") from e
exception.Exception.ServiceException: Unable to fetch alarm records.
2025-03-05 23:33:16,855 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 53, in build_production_count
    alarms = self.alarm_service.get_by_equipment_id(equipment.id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 44, in get_by_equipment_id
    raise ServiceException("Unable to fetch alarm records.") from e
exception.Exception.ServiceException: Unable to fetch alarm records.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:33:17,656 - ERROR - ALARM TRIGGERED: Heartbeat timeout for MAQ01. Elapsed = 11.01s, Timeout = 11s
2025-03-05 23:33:17,657 - WARNING - PLC client connection failed.
2025-03-05 23:33:17,658 - ERROR - Failed to connect to PLC. Cannot write alarm data.
2025-03-05 23:33:17,658 - WARNING - Alarm written to PLC for MAQ01: Byte 8, Bit 0, Value 1
2025-03-05 23:33:18,861 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:33:18,864 - ERROR - Error fetching alarm records for equipment ID '1': (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-03-05 23:33:18,867 - ERROR - Error building production count message: Unable to fetch alarm records.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 53, in build_production_count
    alarms = self.alarm_service.get_by_equipment_id(equipment.id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 44, in get_by_equipment_id
    raise ServiceException("Unable to fetch alarm records.") from e
exception.Exception.ServiceException: Unable to fetch alarm records.
2025-03-05 23:33:18,870 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 53, in build_production_count
    alarms = self.alarm_service.get_by_equipment_id(equipment.id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 44, in get_by_equipment_id
    raise ServiceException("Unable to fetch alarm records.") from e
exception.Exception.ServiceException: Unable to fetch alarm records.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:33:20,882 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:33:20,885 - ERROR - Error fetching alarm records for equipment ID '1': (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-03-05 23:33:20,887 - ERROR - Error building production count message: Unable to fetch alarm records.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 53, in build_production_count
    alarms = self.alarm_service.get_by_equipment_id(equipment.id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 44, in get_by_equipment_id
    raise ServiceException("Unable to fetch alarm records.") from e
exception.Exception.ServiceException: Unable to fetch alarm records.
2025-03-05 23:33:20,890 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 53, in build_production_count
    alarms = self.alarm_service.get_by_equipment_id(equipment.id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 44, in get_by_equipment_id
    raise ServiceException("Unable to fetch alarm records.") from e
exception.Exception.ServiceException: Unable to fetch alarm records.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:33:22,900 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:33:22,903 - ERROR - Error fetching alarm records for equipment ID '1': (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-03-05 23:33:22,906 - ERROR - Error building production count message: Unable to fetch alarm records.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 53, in build_production_count
    alarms = self.alarm_service.get_by_equipment_id(equipment.id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 44, in get_by_equipment_id
    raise ServiceException("Unable to fetch alarm records.") from e
exception.Exception.ServiceException: Unable to fetch alarm records.
2025-03-05 23:33:22,908 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 53, in build_production_count
    alarms = self.alarm_service.get_by_equipment_id(equipment.id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 44, in get_by_equipment_id
    raise ServiceException("Unable to fetch alarm records.") from e
exception.Exception.ServiceException: Unable to fetch alarm records.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:33:24,923 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:33:24,926 - ERROR - Error fetching alarm records for equipment ID '1': (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-03-05 23:33:24,930 - ERROR - Error building production count message: Unable to fetch alarm records.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 53, in build_production_count
    alarms = self.alarm_service.get_by_equipment_id(equipment.id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 44, in get_by_equipment_id
    raise ServiceException("Unable to fetch alarm records.") from e
exception.Exception.ServiceException: Unable to fetch alarm records.
2025-03-05 23:33:24,932 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 38, in get_by_equipment_id
    return self.alarm_record_dao.find_by_equipment_id(equipment_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\database\dao\alarm_record_dao.py", line 27, in find_by_equipment_id
    .all()
     ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2699, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT alarm_record.id AS alarm_record_id, alarm_record.value AS alarm_record_value, alarm_record.registered_at AS alarm_record_registered_at, alarm_record.variable_id AS alarm_record_variable_id 
FROM alarm_record JOIN variable ON variable.id = alarm_record.variable_id 
WHERE variable.equipment_id = %(equipment_id_1)s]
[parameters: {'equipment_id_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 53, in build_production_count
    alarms = self.alarm_service.get_by_equipment_id(equipment.id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\alarm_record_service.py", line 44, in get_by_equipment_id
    raise ServiceException("Unable to fetch alarm records.") from e
exception.Exception.ServiceException: Unable to fetch alarm records.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 70, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:35:27,267 - INFO - Initializing MQTT connection...
2025-03-05 23:35:27,478 - INFO - Starting periodic message service...
2025-03-05 23:35:27,503 - INFO - Started periodic message sending thread.
2025-03-05 23:35:27,506 - INFO - Starting heartbeat monitoring...
2025-03-05 23:35:27,506 - INFO - Starting heartbeat monitor thread.
2025-03-05 23:35:27,507 - INFO - Heartbeat monitoring started.
2025-03-05 23:35:27,507 - INFO - Starting MQTT client loop...
2025-03-05 23:35:27,508 - INFO - All equipment schedules initialized.
2025-03-05 23:35:27,548 - INFO - Initialized heartbeat tracking for MAQ01.
2025-03-05 23:35:28,550 - INFO - Configuration updated for MAQ01. New cycle = 2s
2025-03-05 23:35:29,511 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:35:29,871 - ERROR - Error fetching counters for equipment ID 1: 'CounterRecordService' object has no attribute 'get_last_counter_by_output_id'
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 93, in _get_counters
    counter = self.counter_record_service.get_last_counter_by_output_id(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'CounterRecordService' object has no attribute 'get_last_counter_by_output_id'
2025-03-05 23:35:29,872 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:35:29,873 - INFO - Sent ProductionCount message to 'NAU/CRK/GTW003/BE' (Size: 153 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": []}
2025-03-05 23:35:29,873 - INFO - Sent production message for equipment 1.
2025-03-05 23:35:31,884 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:35:31,888 - ERROR - Error fetching counters for equipment ID 1: 'CounterRecordService' object has no attribute 'get_last_counter_by_output_id'
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 93, in _get_counters
    counter = self.counter_record_service.get_last_counter_by_output_id(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'CounterRecordService' object has no attribute 'get_last_counter_by_output_id'
2025-03-05 23:35:31,889 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:35:31,889 - INFO - Sent ProductionCount message to 'NAU/CRK/GTW003/BE' (Size: 153 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": []}
2025-03-05 23:35:31,889 - INFO - Sent production message for equipment 1.
2025-03-05 23:35:33,893 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:35:33,897 - ERROR - Error fetching counters for equipment ID 1: 'CounterRecordService' object has no attribute 'get_last_counter_by_output_id'
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 93, in _get_counters
    counter = self.counter_record_service.get_last_counter_by_output_id(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'CounterRecordService' object has no attribute 'get_last_counter_by_output_id'
2025-03-05 23:35:33,898 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:35:33,898 - INFO - Sent ProductionCount message to 'NAU/CRK/GTW003/BE' (Size: 153 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": []}
2025-03-05 23:35:33,899 - INFO - Sent production message for equipment 1.
2025-03-05 23:37:00,306 - INFO - Initializing MQTT connection...
2025-03-05 23:37:00,500 - INFO - Starting periodic message service...
2025-03-05 23:37:00,523 - INFO - Started periodic message sending thread.
2025-03-05 23:37:00,527 - INFO - Starting heartbeat monitoring...
2025-03-05 23:37:00,527 - INFO - Starting heartbeat monitor thread.
2025-03-05 23:37:00,529 - INFO - Heartbeat monitoring started.
2025-03-05 23:37:00,530 - INFO - All equipment schedules initialized.
2025-03-05 23:37:00,530 - INFO - Starting MQTT client loop...
2025-03-05 23:37:00,568 - INFO - Initialized heartbeat tracking for MAQ01.
2025-03-05 23:37:01,569 - INFO - Configuration updated for MAQ01. New cycle = 2s
2025-03-05 23:37:02,537 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:37:03,011 - ERROR - Error fetching last counter record for equipment output ID '1': No counter records found for equipment output ID '1'
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\counter_record_service.py", line 43, in get_last_by_equipment_output_id
    raise NotFoundException(
exception.Exception.NotFoundException: No counter records found for equipment output ID '1'
2025-03-05 23:37:03,011 - ERROR - Error fetching counters for equipment ID 1: Unable to fetch last counter record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\counter_record_service.py", line 43, in get_last_by_equipment_output_id
    raise NotFoundException(
exception.Exception.NotFoundException: No counter records found for equipment output ID '1'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 93, in _get_counters
    counter = self.counter_record_service.get_last_by_equipment_output_id(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\counter_record_service.py", line 52, in get_last_by_equipment_output_id
    raise ServiceException("Unable to fetch last counter record.") from e
exception.Exception.ServiceException: Unable to fetch last counter record.
2025-03-05 23:37:03,012 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:37:03,014 - INFO - Sent ProductionCount message to 'NAU/CRK/GTW003/BE' (Size: 153 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": []}
2025-03-05 23:37:03,014 - INFO - Sent production message for equipment 1.
2025-03-05 23:37:05,024 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:37:05,028 - ERROR - Error fetching last counter record for equipment output ID '1': No counter records found for equipment output ID '1'
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\counter_record_service.py", line 43, in get_last_by_equipment_output_id
    raise NotFoundException(
exception.Exception.NotFoundException: No counter records found for equipment output ID '1'
2025-03-05 23:37:05,028 - ERROR - Error fetching counters for equipment ID 1: Unable to fetch last counter record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\counter_record_service.py", line 43, in get_last_by_equipment_output_id
    raise NotFoundException(
exception.Exception.NotFoundException: No counter records found for equipment output ID '1'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 93, in _get_counters
    counter = self.counter_record_service.get_last_by_equipment_output_id(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\counter_record_service.py", line 52, in get_last_by_equipment_output_id
    raise ServiceException("Unable to fetch last counter record.") from e
exception.Exception.ServiceException: Unable to fetch last counter record.
2025-03-05 23:37:05,030 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:37:05,031 - INFO - Sent ProductionCount message to 'NAU/CRK/GTW003/BE' (Size: 153 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": []}
2025-03-05 23:37:05,031 - INFO - Sent production message for equipment 1.
2025-03-05 23:37:07,033 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:37:07,037 - ERROR - Error fetching last counter record for equipment output ID '1': No counter records found for equipment output ID '1'
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\counter_record_service.py", line 43, in get_last_by_equipment_output_id
    raise NotFoundException(
exception.Exception.NotFoundException: No counter records found for equipment output ID '1'
2025-03-05 23:37:07,037 - ERROR - Error fetching counters for equipment ID 1: Unable to fetch last counter record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\counter_record_service.py", line 43, in get_last_by_equipment_output_id
    raise NotFoundException(
exception.Exception.NotFoundException: No counter records found for equipment output ID '1'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 93, in _get_counters
    counter = self.counter_record_service.get_last_by_equipment_output_id(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\counter_record_service.py", line 52, in get_last_by_equipment_output_id
    raise ServiceException("Unable to fetch last counter record.") from e
exception.Exception.ServiceException: Unable to fetch last counter record.
2025-03-05 23:37:07,038 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:37:07,039 - INFO - Sent ProductionCount message to 'NAU/CRK/GTW003/BE' (Size: 153 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": []}
2025-03-05 23:37:07,039 - INFO - Sent production message for equipment 1.
2025-03-05 23:38:20,798 - INFO - Initializing MQTT connection...
2025-03-05 23:38:21,016 - INFO - Starting periodic message service...
2025-03-05 23:38:21,022 - INFO - Started periodic message sending thread.
2025-03-05 23:38:21,040 - INFO - Starting heartbeat monitoring...
2025-03-05 23:38:21,041 - INFO - Starting heartbeat monitor thread.
2025-03-05 23:38:21,041 - INFO - Heartbeat monitoring started.
2025-03-05 23:38:21,042 - INFO - Starting MQTT client loop...
2025-03-05 23:38:21,042 - INFO - All equipment schedules initialized.
2025-03-05 23:38:21,192 - INFO - Initialized heartbeat tracking for MAQ01.
2025-03-05 23:38:22,193 - INFO - Configuration updated for MAQ01. New cycle = 2s
2025-03-05 23:38:23,050 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:38:23,313 - ERROR - Error fetching last counter record for equipment output ID '1': No counter records found for equipment output ID '1'
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\counter_record_service.py", line 43, in get_last_by_equipment_output_id
    raise NotFoundException(
exception.Exception.NotFoundException: No counter records found for equipment output ID '1'
2025-03-05 23:38:23,314 - ERROR - Error fetching counters for equipment ID 1: Unable to fetch last counter record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\counter_record_service.py", line 43, in get_last_by_equipment_output_id
    raise NotFoundException(
exception.Exception.NotFoundException: No counter records found for equipment output ID '1'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 93, in _get_counters
    counter = self.counter_record_service.get_last_by_equipment_output_id(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\counter_record_service.py", line 52, in get_last_by_equipment_output_id
    raise ServiceException("Unable to fetch last counter record.") from e
exception.Exception.ServiceException: Unable to fetch last counter record.
2025-03-05 23:38:23,315 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:38:23,315 - INFO - Sent ProductionCount message to 'NAU/CRK/GTW003/BE' (Size: 153 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": []}
2025-03-05 23:38:23,317 - INFO - Sent production message for equipment 1.
2025-03-05 23:38:25,318 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:38:25,323 - ERROR - Error fetching last counter record for equipment output ID '1': No counter records found for equipment output ID '1'
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\counter_record_service.py", line 43, in get_last_by_equipment_output_id
    raise NotFoundException(
exception.Exception.NotFoundException: No counter records found for equipment output ID '1'
2025-03-05 23:38:25,324 - ERROR - Error fetching counters for equipment ID 1: Unable to fetch last counter record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\counter_record_service.py", line 43, in get_last_by_equipment_output_id
    raise NotFoundException(
exception.Exception.NotFoundException: No counter records found for equipment output ID '1'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 93, in _get_counters
    counter = self.counter_record_service.get_last_by_equipment_output_id(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\counter_record_service.py", line 52, in get_last_by_equipment_output_id
    raise ServiceException("Unable to fetch last counter record.") from e
exception.Exception.ServiceException: Unable to fetch last counter record.
2025-03-05 23:38:25,325 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:38:25,325 - INFO - Sent ProductionCount message to 'NAU/CRK/GTW003/BE' (Size: 153 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": []}
2025-03-05 23:38:25,326 - INFO - Sent production message for equipment 1.
2025-03-05 23:38:27,330 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:38:27,334 - ERROR - Error fetching last counter record for equipment output ID '1': No counter records found for equipment output ID '1'
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\counter_record_service.py", line 43, in get_last_by_equipment_output_id
    raise NotFoundException(
exception.Exception.NotFoundException: No counter records found for equipment output ID '1'
2025-03-05 23:38:27,335 - ERROR - Error fetching counters for equipment ID 1: Unable to fetch last counter record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\counter_record_service.py", line 43, in get_last_by_equipment_output_id
    raise NotFoundException(
exception.Exception.NotFoundException: No counter records found for equipment output ID '1'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 93, in _get_counters
    counter = self.counter_record_service.get_last_by_equipment_output_id(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\counter_record_service.py", line 52, in get_last_by_equipment_output_id
    raise ServiceException("Unable to fetch last counter record.") from e
exception.Exception.ServiceException: Unable to fetch last counter record.
2025-03-05 23:38:27,335 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:38:27,337 - INFO - Sent ProductionCount message to 'NAU/CRK/GTW003/BE' (Size: 153 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": []}
2025-03-05 23:38:27,337 - INFO - Sent production message for equipment 1.
2025-03-05 23:38:29,349 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:38:29,354 - ERROR - Error fetching last counter record for equipment output ID '1': No counter records found for equipment output ID '1'
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\counter_record_service.py", line 43, in get_last_by_equipment_output_id
    raise NotFoundException(
exception.Exception.NotFoundException: No counter records found for equipment output ID '1'
2025-03-05 23:38:29,354 - ERROR - Error fetching counters for equipment ID 1: Unable to fetch last counter record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\counter_record_service.py", line 43, in get_last_by_equipment_output_id
    raise NotFoundException(
exception.Exception.NotFoundException: No counter records found for equipment output ID '1'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 93, in _get_counters
    counter = self.counter_record_service.get_last_by_equipment_output_id(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\counter_record_service.py", line 52, in get_last_by_equipment_output_id
    raise ServiceException("Unable to fetch last counter record.") from e
exception.Exception.ServiceException: Unable to fetch last counter record.
2025-03-05 23:38:29,355 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:38:29,356 - INFO - Sent ProductionCount message to 'NAU/CRK/GTW003/BE' (Size: 153 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": []}
2025-03-05 23:38:29,356 - INFO - Sent production message for equipment 1.
2025-03-05 23:39:10,385 - INFO - Initializing MQTT connection...
2025-03-05 23:39:10,583 - INFO - Starting periodic message service...
2025-03-05 23:39:10,592 - INFO - Started periodic message sending thread.
2025-03-05 23:39:10,617 - INFO - Starting heartbeat monitoring...
2025-03-05 23:39:10,617 - INFO - Starting heartbeat monitor thread.
2025-03-05 23:39:10,619 - INFO - Heartbeat monitoring started.
2025-03-05 23:39:10,619 - INFO - Starting MQTT client loop...
2025-03-05 23:39:10,619 - INFO - All equipment schedules initialized.
2025-03-05 23:39:10,765 - INFO - Initialized heartbeat tracking for MAQ01.
2025-03-05 23:39:11,767 - INFO - Configuration updated for MAQ01. New cycle = 2s
2025-03-05 23:39:12,630 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:39:12,900 - ERROR - Error fetching last counter record for equipment output ID '1': No counter records found for equipment output ID '1'
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\counter_record_service.py", line 43, in get_last_by_equipment_output_id
    raise NotFoundException(
exception.Exception.NotFoundException: No counter records found for equipment output ID '1'
2025-03-05 23:39:12,901 - ERROR - Error fetching counters for equipment ID 1: Unable to fetch last counter record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\counter_record_service.py", line 43, in get_last_by_equipment_output_id
    raise NotFoundException(
exception.Exception.NotFoundException: No counter records found for equipment output ID '1'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 93, in _get_counters
    counter = self.counter_record_service.get_last_by_equipment_output_id(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\counter_record_service.py", line 52, in get_last_by_equipment_output_id
    raise ServiceException("Unable to fetch last counter record.") from e
exception.Exception.ServiceException: Unable to fetch last counter record.
2025-03-05 23:39:12,903 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:39:12,903 - INFO - Sent ProductionCount message to 'NAU/CRK/GTW003/BE' (Size: 153 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": []}
2025-03-05 23:39:12,906 - INFO - Sent production message for equipment 1.
2025-03-05 23:39:14,910 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:39:14,914 - ERROR - Error fetching last counter record for equipment output ID '1': No counter records found for equipment output ID '1'
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\counter_record_service.py", line 43, in get_last_by_equipment_output_id
    raise NotFoundException(
exception.Exception.NotFoundException: No counter records found for equipment output ID '1'
2025-03-05 23:39:14,915 - ERROR - Error fetching counters for equipment ID 1: Unable to fetch last counter record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\counter_record_service.py", line 43, in get_last_by_equipment_output_id
    raise NotFoundException(
exception.Exception.NotFoundException: No counter records found for equipment output ID '1'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 93, in _get_counters
    counter = self.counter_record_service.get_last_by_equipment_output_id(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\counter_record_service.py", line 52, in get_last_by_equipment_output_id
    raise ServiceException("Unable to fetch last counter record.") from e
exception.Exception.ServiceException: Unable to fetch last counter record.
2025-03-05 23:39:14,916 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:39:14,916 - INFO - Sent ProductionCount message to 'NAU/CRK/GTW003/BE' (Size: 153 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": []}
2025-03-05 23:39:14,917 - INFO - Sent production message for equipment 1.
2025-03-05 23:39:16,932 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:39:16,936 - ERROR - Error fetching last counter record for equipment output ID '1': No counter records found for equipment output ID '1'
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\counter_record_service.py", line 43, in get_last_by_equipment_output_id
    raise NotFoundException(
exception.Exception.NotFoundException: No counter records found for equipment output ID '1'
2025-03-05 23:39:16,938 - ERROR - Error fetching counters for equipment ID 1: Unable to fetch last counter record.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\counter_record_service.py", line 43, in get_last_by_equipment_output_id
    raise NotFoundException(
exception.Exception.NotFoundException: No counter records found for equipment output ID '1'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 93, in _get_counters
    counter = self.counter_record_service.get_last_by_equipment_output_id(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\counter_record_service.py", line 52, in get_last_by_equipment_output_id
    raise ServiceException("Unable to fetch last counter record.") from e
exception.Exception.ServiceException: Unable to fetch last counter record.
2025-03-05 23:39:16,939 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:39:16,939 - INFO - Sent ProductionCount message to 'NAU/CRK/GTW003/BE' (Size: 153 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": []}
2025-03-05 23:39:16,940 - INFO - Sent production message for equipment 1.
2025-03-05 23:43:16,403 - INFO - Initializing MQTT connection...
2025-03-05 23:43:16,582 - INFO - Starting periodic message service...
2025-03-05 23:43:16,606 - INFO - Started periodic message sending thread.
2025-03-05 23:43:16,609 - INFO - Starting heartbeat monitoring...
2025-03-05 23:43:16,610 - INFO - Starting heartbeat monitor thread.
2025-03-05 23:43:16,610 - INFO - Heartbeat monitoring started.
2025-03-05 23:43:16,610 - INFO - All equipment schedules initialized.
2025-03-05 23:43:16,611 - INFO - Starting MQTT client loop...
2025-03-05 23:43:16,648 - INFO - Initialized heartbeat tracking for MAQ01.
2025-03-05 23:43:17,650 - INFO - Configuration updated for MAQ01. New cycle = 2s
2025-03-05 23:43:18,625 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:43:18,975 - WARNING - No counter records found for equipment output ID '1', returning 0.
2025-03-05 23:43:18,976 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:43:18,976 - ERROR - Error building production count message: 'dict' object has no attribute '__dict__'
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 64, in build_production_count
    counters=[counter.__dict__ for counter in counters],
              ^^^^^^^^^^^^^^^^
AttributeError: 'dict' object has no attribute '__dict__'. Did you mean: '__dir__'?
2025-03-05 23:43:18,977 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 64, in build_production_count
    counters=[counter.__dict__ for counter in counters],
              ^^^^^^^^^^^^^^^^
AttributeError: 'dict' object has no attribute '__dict__'. Did you mean: '__dir__'?

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 69, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:43:20,978 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:43:20,982 - WARNING - No counter records found for equipment output ID '1', returning 0.
2025-03-05 23:43:20,983 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:43:20,983 - ERROR - Error building production count message: 'dict' object has no attribute '__dict__'
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 64, in build_production_count
    counters=[counter.__dict__ for counter in counters],
              ^^^^^^^^^^^^^^^^
AttributeError: 'dict' object has no attribute '__dict__'. Did you mean: '__dir__'?
2025-03-05 23:43:20,983 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 64, in build_production_count
    counters=[counter.__dict__ for counter in counters],
              ^^^^^^^^^^^^^^^^
AttributeError: 'dict' object has no attribute '__dict__'. Did you mean: '__dir__'?

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 69, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:43:22,998 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:43:23,002 - WARNING - No counter records found for equipment output ID '1', returning 0.
2025-03-05 23:43:23,002 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:43:23,002 - ERROR - Error building production count message: 'dict' object has no attribute '__dict__'
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 64, in build_production_count
    counters=[counter.__dict__ for counter in counters],
              ^^^^^^^^^^^^^^^^
AttributeError: 'dict' object has no attribute '__dict__'. Did you mean: '__dir__'?
2025-03-05 23:43:23,004 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 64, in build_production_count
    counters=[counter.__dict__ for counter in counters],
              ^^^^^^^^^^^^^^^^
AttributeError: 'dict' object has no attribute '__dict__'. Did you mean: '__dir__'?

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 69, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:43:25,021 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:43:25,025 - WARNING - No counter records found for equipment output ID '1', returning 0.
2025-03-05 23:43:25,025 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:43:25,026 - ERROR - Error building production count message: 'dict' object has no attribute '__dict__'
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 64, in build_production_count
    counters=[counter.__dict__ for counter in counters],
              ^^^^^^^^^^^^^^^^
AttributeError: 'dict' object has no attribute '__dict__'. Did you mean: '__dir__'?
2025-03-05 23:43:25,027 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 64, in build_production_count
    counters=[counter.__dict__ for counter in counters],
              ^^^^^^^^^^^^^^^^
AttributeError: 'dict' object has no attribute '__dict__'. Did you mean: '__dir__'?

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 69, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:43:27,038 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:43:27,041 - WARNING - No counter records found for equipment output ID '1', returning 0.
2025-03-05 23:43:27,042 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:43:27,042 - ERROR - Error building production count message: 'dict' object has no attribute '__dict__'
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 64, in build_production_count
    counters=[counter.__dict__ for counter in counters],
              ^^^^^^^^^^^^^^^^
AttributeError: 'dict' object has no attribute '__dict__'. Did you mean: '__dir__'?
2025-03-05 23:43:27,043 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 64, in build_production_count
    counters=[counter.__dict__ for counter in counters],
              ^^^^^^^^^^^^^^^^
AttributeError: 'dict' object has no attribute '__dict__'. Did you mean: '__dir__'?

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 69, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:43:27,662 - ERROR - ALARM TRIGGERED: Heartbeat timeout for MAQ01. Elapsed = 11.01s, Timeout = 11s
2025-03-05 23:43:27,663 - WARNING - PLC client connection failed.
2025-03-05 23:43:27,663 - ERROR - Failed to connect to PLC. Cannot write alarm data.
2025-03-05 23:43:27,664 - WARNING - Alarm written to PLC for MAQ01: Byte 8, Bit 0, Value 1
2025-03-05 23:43:29,052 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:43:29,056 - WARNING - No counter records found for equipment output ID '1', returning 0.
2025-03-05 23:43:29,056 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:43:29,057 - ERROR - Error building production count message: 'dict' object has no attribute '__dict__'
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 64, in build_production_count
    counters=[counter.__dict__ for counter in counters],
              ^^^^^^^^^^^^^^^^
AttributeError: 'dict' object has no attribute '__dict__'. Did you mean: '__dir__'?
2025-03-05 23:43:29,059 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 64, in build_production_count
    counters=[counter.__dict__ for counter in counters],
              ^^^^^^^^^^^^^^^^
AttributeError: 'dict' object has no attribute '__dict__'. Did you mean: '__dir__'?

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 69, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:43:31,060 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:43:31,065 - WARNING - No counter records found for equipment output ID '1', returning 0.
2025-03-05 23:43:31,065 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:43:31,065 - ERROR - Error building production count message: 'dict' object has no attribute '__dict__'
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 64, in build_production_count
    counters=[counter.__dict__ for counter in counters],
              ^^^^^^^^^^^^^^^^
AttributeError: 'dict' object has no attribute '__dict__'. Did you mean: '__dir__'?
2025-03-05 23:43:31,066 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 64, in build_production_count
    counters=[counter.__dict__ for counter in counters],
              ^^^^^^^^^^^^^^^^
AttributeError: 'dict' object has no attribute '__dict__'. Did you mean: '__dir__'?

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 69, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:43:33,074 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:43:33,078 - WARNING - No counter records found for equipment output ID '1', returning 0.
2025-03-05 23:43:33,078 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:43:33,079 - ERROR - Error building production count message: 'dict' object has no attribute '__dict__'
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 64, in build_production_count
    counters=[counter.__dict__ for counter in counters],
              ^^^^^^^^^^^^^^^^
AttributeError: 'dict' object has no attribute '__dict__'. Did you mean: '__dir__'?
2025-03-05 23:43:33,079 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 64, in build_production_count
    counters=[counter.__dict__ for counter in counters],
              ^^^^^^^^^^^^^^^^
AttributeError: 'dict' object has no attribute '__dict__'. Did you mean: '__dir__'?

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 69, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:43:35,083 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:43:35,088 - WARNING - No counter records found for equipment output ID '1', returning 0.
2025-03-05 23:43:35,088 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:43:35,088 - ERROR - Error building production count message: 'dict' object has no attribute '__dict__'
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 64, in build_production_count
    counters=[counter.__dict__ for counter in counters],
              ^^^^^^^^^^^^^^^^
AttributeError: 'dict' object has no attribute '__dict__'. Did you mean: '__dir__'?
2025-03-05 23:43:35,090 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 64, in build_production_count
    counters=[counter.__dict__ for counter in counters],
              ^^^^^^^^^^^^^^^^
AttributeError: 'dict' object has no attribute '__dict__'. Did you mean: '__dir__'?

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 69, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:43:37,106 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:43:37,109 - WARNING - No counter records found for equipment output ID '1', returning 0.
2025-03-05 23:43:37,110 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:43:37,110 - ERROR - Error building production count message: 'dict' object has no attribute '__dict__'
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 64, in build_production_count
    counters=[counter],
              ^^^^^^^^^^
AttributeError: 'dict' object has no attribute '__dict__'. Did you mean: '__dir__'?
2025-03-05 23:43:37,112 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 64, in build_production_count
    counters=[counter],
              ^^^^^^^^^^
AttributeError: 'dict' object has no attribute '__dict__'. Did you mean: '__dir__'?

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 69, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:43:39,128 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:43:39,132 - WARNING - No counter records found for equipment output ID '1', returning 0.
2025-03-05 23:43:39,133 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:43:39,133 - ERROR - Error building production count message: 'dict' object has no attribute '__dict__'
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 64, in build_production_count
    counters=[counter],
              ^^^^^^^^^^
AttributeError: 'dict' object has no attribute '__dict__'. Did you mean: '__dir__'?
2025-03-05 23:43:39,134 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 64, in build_production_count
    counters=[counter],
              ^^^^^^^^^^
AttributeError: 'dict' object has no attribute '__dict__'. Did you mean: '__dir__'?

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 69, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:43:41,142 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:43:41,146 - WARNING - No counter records found for equipment output ID '1', returning 0.
2025-03-05 23:43:41,146 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:43:41,147 - ERROR - Error building production count message: 'dict' object has no attribute '__dict__'
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 64, in build_production_count
    counters=[counter],
              ^^^^^^^^^^
AttributeError: 'dict' object has no attribute '__dict__'. Did you mean: '__dir__'?
2025-03-05 23:43:41,147 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 64, in build_production_count
    counters=[counter],
              ^^^^^^^^^^
AttributeError: 'dict' object has no attribute '__dict__'. Did you mean: '__dir__'?

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 69, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:44:04,873 - INFO - Initializing MQTT connection...
2025-03-05 23:44:05,078 - INFO - Starting periodic message service...
2025-03-05 23:44:05,102 - INFO - Started periodic message sending thread.
2025-03-05 23:44:05,106 - INFO - Starting heartbeat monitoring...
2025-03-05 23:44:05,106 - INFO - Starting heartbeat monitor thread.
2025-03-05 23:44:05,107 - INFO - Heartbeat monitoring started.
2025-03-05 23:44:05,107 - INFO - All equipment schedules initialized.
2025-03-05 23:44:05,107 - INFO - Starting MQTT client loop...
2025-03-05 23:44:05,142 - INFO - Initialized heartbeat tracking for MAQ01.
2025-03-05 23:44:06,143 - INFO - Configuration updated for MAQ01. New cycle = 2s
2025-03-05 23:44:07,107 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:44:07,395 - WARNING - No counter records found for equipment output ID '1', returning 0.
2025-03-05 23:44:07,396 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:44:07,396 - ERROR - Error building production count message: name 'counter' is not defined
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 64, in build_production_count
    counters=[counter],
              ^^^^^^^
NameError: name 'counter' is not defined. Did you mean: 'counters'?
2025-03-05 23:44:07,399 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 64, in build_production_count
    counters=[counter],
              ^^^^^^^
NameError: name 'counter' is not defined. Did you mean: 'counters'?

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 69, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:44:09,408 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:44:09,413 - WARNING - No counter records found for equipment output ID '1', returning 0.
2025-03-05 23:44:09,413 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:44:09,414 - ERROR - Error building production count message: name 'counter' is not defined
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 64, in build_production_count
    counters=[counter],
              ^^^^^^^
NameError: name 'counter' is not defined. Did you mean: 'counters'?
2025-03-05 23:44:09,414 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 64, in build_production_count
    counters=[counter],
              ^^^^^^^
NameError: name 'counter' is not defined. Did you mean: 'counters'?

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 69, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:44:11,426 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:44:11,431 - WARNING - No counter records found for equipment output ID '1', returning 0.
2025-03-05 23:44:11,431 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:44:11,432 - ERROR - Error building production count message: name 'counter' is not defined
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 64, in build_production_count
    counters=[counter],
              ^^^^^^^
NameError: name 'counter' is not defined. Did you mean: 'counters'?
2025-03-05 23:44:11,434 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 64, in build_production_count
    counters=[counter],
              ^^^^^^^
NameError: name 'counter' is not defined. Did you mean: 'counters'?

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 69, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:44:13,444 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:44:13,449 - WARNING - No counter records found for equipment output ID '1', returning 0.
2025-03-05 23:44:13,450 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:44:13,450 - ERROR - Error building production count message: name 'counter' is not defined
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 64, in build_production_count
    counters=[counter],
              ^^^^^^^
NameError: name 'counter' is not defined. Did you mean: 'counters'?
2025-03-05 23:44:13,451 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 64, in build_production_count
    counters=[counter],
              ^^^^^^^
NameError: name 'counter' is not defined. Did you mean: 'counters'?

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 69, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:44:15,463 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:44:15,467 - WARNING - No counter records found for equipment output ID '1', returning 0.
2025-03-05 23:44:15,467 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:44:15,467 - ERROR - Error building production count message: name 'counter' is not defined
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 64, in build_production_count
    counters=[counter],
              ^^^^^^^
NameError: name 'counter' is not defined. Did you mean: 'counters'?
2025-03-05 23:44:15,468 - ERROR - Error sending production message for equipment 1: Failed to build production count message.
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 64, in build_production_count
    counters=[counter],
              ^^^^^^^
NameError: name 'counter' is not defined. Did you mean: 'counters'?

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 52, in _send_production_message
    production_values = self.production_count_service.build_production_count(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\production_count_service.py", line 69, in build_production_count
    raise ServiceException("Failed to build production count message.") from e
exception.Exception.ServiceException: Failed to build production count message.
2025-03-05 23:44:16,154 - ERROR - ALARM TRIGGERED: Heartbeat timeout for MAQ01. Elapsed = 11.01s, Timeout = 11s
2025-03-05 23:44:16,155 - WARNING - PLC client connection failed.
2025-03-05 23:44:16,155 - ERROR - Failed to connect to PLC. Cannot write alarm data.
2025-03-05 23:44:16,155 - WARNING - Alarm written to PLC for MAQ01: Byte 8, Bit 0, Value 1
2025-03-05 23:44:32,425 - INFO - Initializing MQTT connection...
2025-03-05 23:44:32,629 - INFO - Starting periodic message service...
2025-03-05 23:44:32,658 - INFO - Started periodic message sending thread.
2025-03-05 23:44:32,662 - INFO - Starting heartbeat monitoring...
2025-03-05 23:44:32,663 - INFO - Starting heartbeat monitor thread.
2025-03-05 23:44:32,663 - INFO - Heartbeat monitoring started.
2025-03-05 23:44:32,664 - INFO - All equipment schedules initialized.
2025-03-05 23:44:32,664 - INFO - Starting MQTT client loop...
2025-03-05 23:44:32,700 - INFO - Initialized heartbeat tracking for MAQ01.
2025-03-05 23:44:33,703 - INFO - Configuration updated for MAQ01. New cycle = 2s
2025-03-05 23:44:34,667 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:44:34,933 - WARNING - No counter records found for equipment output ID '1', returning 0.
2025-03-05 23:44:34,933 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:44:34,934 - INFO - Sent ProductionCount message to 'NAU/CRK/GTW003/BE' (Size: 188 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": [{"outputCode": "OUT01", "value": 0}]}
2025-03-05 23:44:34,934 - INFO - Sent production message for equipment 1.
2025-03-05 23:44:36,936 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:44:36,940 - WARNING - No counter records found for equipment output ID '1', returning 0.
2025-03-05 23:44:36,940 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:44:36,940 - INFO - Sent ProductionCount message to 'NAU/CRK/GTW003/BE' (Size: 188 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": [{"outputCode": "OUT01", "value": 0}]}
2025-03-05 23:44:36,941 - INFO - Sent production message for equipment 1.
2025-03-05 23:44:38,947 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:44:38,950 - WARNING - No counter records found for equipment output ID '1', returning 0.
2025-03-05 23:44:38,951 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:44:38,951 - INFO - Sent ProductionCount message to 'NAU/CRK/GTW003/BE' (Size: 188 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": [{"outputCode": "OUT01", "value": 0}]}
2025-03-05 23:44:38,955 - INFO - Sent production message for equipment 1.
2025-03-05 23:44:40,958 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:44:40,963 - WARNING - No counter records found for equipment output ID '1', returning 0.
2025-03-05 23:44:40,963 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:44:40,964 - INFO - Sent ProductionCount message to 'NAU/CRK/GTW003/BE' (Size: 188 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": [{"outputCode": "OUT01", "value": 0}]}
2025-03-05 23:44:40,964 - INFO - Sent production message for equipment 1.
2025-03-05 23:44:42,969 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:44:42,973 - WARNING - No counter records found for equipment output ID '1', returning 0.
2025-03-05 23:44:42,973 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:44:42,974 - INFO - Sent ProductionCount message to 'NAU/CRK/GTW003/BE' (Size: 188 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": [{"outputCode": "OUT01", "value": 0}]}
2025-03-05 23:44:42,974 - INFO - Sent production message for equipment 1.
2025-03-05 23:44:43,713 - ERROR - ALARM TRIGGERED: Heartbeat timeout for MAQ01. Elapsed = 11.01s, Timeout = 11s
2025-03-05 23:44:43,714 - WARNING - PLC client connection failed.
2025-03-05 23:44:43,714 - ERROR - Failed to connect to PLC. Cannot write alarm data.
2025-03-05 23:44:43,714 - WARNING - Alarm written to PLC for MAQ01: Byte 8, Bit 0, Value 1
2025-03-05 23:44:44,987 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:44:44,991 - WARNING - No counter records found for equipment output ID '1', returning 0.
2025-03-05 23:44:44,991 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:44:44,993 - INFO - Sent ProductionCount message to 'NAU/CRK/GTW003/BE' (Size: 188 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": [{"outputCode": "OUT01", "value": 0}]}
2025-03-05 23:44:44,993 - INFO - Sent production message for equipment 1.
2025-03-05 23:44:46,998 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:44:47,002 - WARNING - No counter records found for equipment output ID '1', returning 0.
2025-03-05 23:44:47,002 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:44:47,002 - INFO - Sent ProductionCount message to 'NAU/CRK/GTW003/BE' (Size: 188 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": [{"outputCode": "OUT01", "value": 0}]}
2025-03-05 23:44:47,003 - INFO - Sent production message for equipment 1.
2025-03-05 23:44:49,010 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:44:49,015 - WARNING - No counter records found for equipment output ID '1', returning 0.
2025-03-05 23:44:49,015 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:44:49,016 - INFO - Sent ProductionCount message to 'NAU/CRK/GTW003/BE' (Size: 188 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": [{"outputCode": "OUT01", "value": 0}]}
2025-03-05 23:44:49,016 - INFO - Sent production message for equipment 1.
2025-03-05 23:44:51,021 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:44:51,025 - WARNING - No counter records found for equipment output ID '1', returning 0.
2025-03-05 23:44:51,027 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:44:51,027 - INFO - Sent ProductionCount message to 'NAU/CRK/GTW003/BE' (Size: 188 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": [{"outputCode": "OUT01", "value": 0}]}
2025-03-05 23:44:51,027 - INFO - Sent production message for equipment 1.
2025-03-05 23:50:17,170 - INFO - Initializing MQTT connection...
2025-03-05 23:50:17,376 - INFO - Starting periodic message service...
2025-03-05 23:50:17,385 - INFO - Started periodic message sending thread.
2025-03-05 23:50:17,400 - INFO - Starting heartbeat monitoring...
2025-03-05 23:50:17,401 - INFO - Starting heartbeat monitor thread.
2025-03-05 23:50:17,401 - INFO - Heartbeat monitoring started.
2025-03-05 23:50:17,402 - ERROR - Error executing production count: Scheduler.schedule_task() got an unexpected keyword argument 'interval'
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 42, in execute_production_count
    self.scheduler.schedule_task(
TypeError: Scheduler.schedule_task() got an unexpected keyword argument 'interval'
2025-03-05 23:50:17,402 - INFO - Starting MQTT client loop...
2025-03-05 23:50:17,439 - INFO - Initialized heartbeat tracking for MAQ01.
2025-03-05 23:50:18,441 - INFO - Configuration updated for MAQ01. New cycle = 2s
2025-03-05 23:50:28,454 - ERROR - ALARM TRIGGERED: Heartbeat timeout for MAQ01. Elapsed = 11.02s, Timeout = 11s
2025-03-05 23:50:28,454 - WARNING - PLC client connection failed.
2025-03-05 23:50:28,455 - ERROR - Failed to connect to PLC. Cannot write alarm data.
2025-03-05 23:50:28,455 - WARNING - Alarm written to PLC for MAQ01: Byte 8, Bit 0, Value 1
2025-03-05 23:53:57,295 - INFO - Initializing MQTT connection...
2025-03-05 23:53:57,515 - INFO - Starting periodic message service...
2025-03-05 23:53:57,521 - INFO - Started periodic message sending thread.
2025-03-05 23:53:57,552 - INFO - Starting heartbeat monitoring...
2025-03-05 23:53:57,552 - INFO - Starting heartbeat monitor thread.
2025-03-05 23:53:57,553 - INFO - Heartbeat monitoring started.
2025-03-05 23:53:57,553 - ERROR - Error executing production count: Scheduler.schedule_task() got an unexpected keyword argument 'interval'
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 43, in execute_production_count
    self.scheduler.schedule_task(
TypeError: Scheduler.schedule_task() got an unexpected keyword argument 'interval'
2025-03-05 23:53:57,554 - INFO - Starting MQTT client loop...
2025-03-05 23:53:57,590 - INFO - Initialized heartbeat tracking for MAQ01.
2025-03-05 23:53:58,592 - INFO - Configuration updated for MAQ01. New cycle = 120m
2025-03-05 23:54:08,607 - ERROR - ALARM TRIGGERED: Heartbeat timeout for MAQ01. Elapsed = 11.02s, Timeout = 11s
2025-03-05 23:54:08,608 - WARNING - PLC client connection failed.
2025-03-05 23:54:08,608 - ERROR - Failed to connect to PLC. Cannot write alarm data.
2025-03-05 23:54:08,609 - WARNING - Alarm written to PLC for MAQ01: Byte 8, Bit 0, Value 1
2025-03-05 23:57:03,140 - INFO - Initializing MQTT connection...
2025-03-05 23:57:03,380 - INFO - Starting periodic message service...
2025-03-05 23:57:03,406 - INFO - Started periodic message sending thread.
2025-03-05 23:57:03,412 - INFO - Starting heartbeat monitoring...
2025-03-05 23:57:03,412 - INFO - Starting heartbeat monitor thread.
2025-03-05 23:57:03,413 - INFO - Heartbeat monitoring started.
2025-03-05 23:57:03,413 - INFO - All equipment schedules initialized.
2025-03-05 23:57:03,413 - INFO - Starting MQTT client loop...
2025-03-05 23:57:03,450 - INFO - Initialized heartbeat tracking for MAQ01.
2025-03-05 23:57:04,452 - INFO - Configuration updated for MAQ01. New cycle = 2 minute(s)
2025-03-05 23:57:05,415 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:57:05,860 - WARNING - No counter records found for equipment output ID '1', returning 0.
2025-03-05 23:57:05,860 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:57:05,861 - INFO - Sent ProductionCount message to 'NAU/CRK/GTW003/BE' (Size: 188 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": [{"outputCode": "OUT01", "value": 0}]}
2025-03-05 23:57:05,861 - INFO - Sent production message for equipment 1.
2025-03-05 23:57:07,869 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:57:07,874 - WARNING - No counter records found for equipment output ID '1', returning 0.
2025-03-05 23:57:07,875 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:57:07,875 - INFO - Sent ProductionCount message to 'NAU/CRK/GTW003/BE' (Size: 188 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": [{"outputCode": "OUT01", "value": 0}]}
2025-03-05 23:57:07,876 - INFO - Sent production message for equipment 1.
2025-03-05 23:57:09,889 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:57:09,893 - WARNING - No counter records found for equipment output ID '1', returning 0.
2025-03-05 23:57:09,893 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:57:09,894 - INFO - Sent ProductionCount message to 'NAU/CRK/GTW003/BE' (Size: 188 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": [{"outputCode": "OUT01", "value": 0}]}
2025-03-05 23:57:09,894 - INFO - Sent production message for equipment 1.
2025-03-05 23:57:11,905 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:57:11,909 - WARNING - No counter records found for equipment output ID '1', returning 0.
2025-03-05 23:57:11,909 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:57:11,910 - INFO - Sent ProductionCount message to 'NAU/CRK/GTW003/BE' (Size: 188 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": [{"outputCode": "OUT01", "value": 0}]}
2025-03-05 23:57:11,910 - INFO - Sent production message for equipment 1.
2025-03-05 23:57:13,922 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:57:13,926 - WARNING - No counter records found for equipment output ID '1', returning 0.
2025-03-05 23:57:13,927 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:57:13,927 - INFO - Sent ProductionCount message to 'NAU/CRK/GTW003/BE' (Size: 188 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": [{"outputCode": "OUT01", "value": 0}]}
2025-03-05 23:57:13,928 - INFO - Sent production message for equipment 1.
2025-03-05 23:57:14,464 - ERROR - ALARM TRIGGERED: Heartbeat timeout for MAQ01. Elapsed = 11.01s, Timeout = 11s
2025-03-05 23:57:14,465 - WARNING - PLC client connection failed.
2025-03-05 23:57:14,465 - ERROR - Failed to connect to PLC. Cannot write alarm data.
2025-03-05 23:57:14,466 - WARNING - Alarm written to PLC for MAQ01: Byte 8, Bit 0, Value 1
2025-03-05 23:57:15,942 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:57:15,947 - WARNING - No counter records found for equipment output ID '1', returning 0.
2025-03-05 23:57:15,948 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:57:15,948 - INFO - Sent ProductionCount message to 'NAU/CRK/GTW003/BE' (Size: 188 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": [{"outputCode": "OUT01", "value": 0}]}
2025-03-05 23:57:15,948 - INFO - Sent production message for equipment 1.
2025-03-05 23:57:17,962 - INFO - Building production count message for equipment 'MAQ01'
2025-03-05 23:57:17,966 - WARNING - No counter records found for equipment output ID '1', returning 0.
2025-03-05 23:57:17,966 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-05 23:57:17,967 - INFO - Sent ProductionCount message to 'NAU/CRK/GTW003/BE' (Size: 188 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": [{"outputCode": "OUT01", "value": 0}]}
2025-03-05 23:57:17,967 - INFO - Sent production message for equipment 1.
2025-03-06 00:00:48,269 - INFO - Initializing MQTT connection...
2025-03-06 00:00:48,493 - INFO - Starting periodic message service...
2025-03-06 00:00:48,517 - INFO - Started periodic message sending thread.
2025-03-06 00:00:48,520 - INFO - Starting heartbeat monitoring...
2025-03-06 00:00:48,520 - INFO - Starting heartbeat monitor thread.
2025-03-06 00:00:48,521 - INFO - Heartbeat monitoring started.
2025-03-06 00:00:48,521 - INFO - Scheduled production message for equipment 1 every 2 minutes.
2025-03-06 00:00:48,521 - INFO - Starting MQTT client loop...
2025-03-06 00:00:48,560 - INFO - Initialized heartbeat tracking for MAQ01.
2025-03-06 00:00:49,561 - INFO - Configuration updated for MAQ01. New cycle = 2 minute(s)
2025-03-06 00:00:59,574 - ERROR - ALARM TRIGGERED: Heartbeat timeout for MAQ01. Elapsed = 11.01s, Timeout = 11s
2025-03-06 00:00:59,574 - WARNING - PLC client connection failed.
2025-03-06 00:00:59,574 - ERROR - Failed to connect to PLC. Cannot write alarm data.
2025-03-06 00:00:59,574 - WARNING - Alarm written to PLC for MAQ01: Byte 8, Bit 0, Value 1
2025-03-06 00:02:48,524 - INFO - Building production count message for equipment 'MAQ01'
2025-03-06 00:02:48,794 - WARNING - No counter records found for equipment output ID '1', returning 0.
2025-03-06 00:02:48,795 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-06 00:02:48,795 - INFO - Sent ProductionCount message to 'NAU/CRK/GTW003/BE' (Size: 188 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": [{"outputCode": "OUT01", "value": 0}]}
2025-03-06 00:02:48,795 - INFO - Sent production message for equipment 1.
2025-03-06 00:04:48,810 - INFO - Building production count message for equipment 'MAQ01'
2025-03-06 00:04:48,814 - WARNING - No counter records found for equipment output ID '1', returning 0.
2025-03-06 00:04:48,815 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-06 00:04:48,815 - INFO - Sent ProductionCount message to 'NAU/CRK/GTW003/BE' (Size: 188 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": [{"outputCode": "OUT01", "value": 0}]}
2025-03-06 00:04:48,816 - INFO - Sent production message for equipment 1.
2025-03-06 00:06:34,579 - INFO - Initializing MQTT connection...
2025-03-06 00:06:34,806 - INFO - Starting periodic message service...
2025-03-06 00:06:34,835 - INFO - Started periodic message sending thread.
2025-03-06 00:06:34,838 - INFO - Starting heartbeat monitoring...
2025-03-06 00:06:34,838 - INFO - Starting heartbeat monitor thread.
2025-03-06 00:06:34,839 - INFO - Heartbeat monitoring started.
2025-03-06 00:06:34,840 - INFO - Scheduled production message for equipment 1 every 2 minutes.
2025-03-06 00:06:34,840 - INFO - Starting MQTT client loop...
2025-03-06 00:06:34,878 - INFO - Initialized heartbeat tracking for MAQ01.
2025-03-06 00:06:35,880 - INFO - Configuration updated for MAQ01. New cycle = 2 minute(s)
2025-03-06 00:06:45,893 - ERROR - ALARM TRIGGERED: Heartbeat timeout for MAQ01. Elapsed = 11.01s, Timeout = 11s
2025-03-06 00:06:45,894 - WARNING - PLC client connection failed.
2025-03-06 00:06:45,895 - ERROR - Failed to connect to PLC. Cannot write alarm data.
2025-03-06 00:06:45,895 - WARNING - Alarm written to PLC for MAQ01: Byte 8, Bit 0, Value 1
2025-03-06 00:08:34,846 - INFO - Building production count message for equipment 'MAQ01'
2025-03-06 00:08:35,219 - WARNING - No counter records found for equipment output ID '1', returning 0.
2025-03-06 00:08:35,219 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-06 00:08:35,220 - INFO - Sent ProductionCount message to 'NAU/CRK/GTW003/BE' (Size: 188 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": [{"outputCode": "OUT01", "value": 0}]}
2025-03-06 00:08:35,220 - INFO - Sent production message for equipment 1.
2025-03-06 00:09:13,902 - INFO - Initializing MQTT connection...
2025-03-06 00:09:14,090 - INFO - Starting periodic message service...
2025-03-06 00:09:14,113 - INFO - Started periodic message sending thread.
2025-03-06 00:09:14,116 - INFO - Starting heartbeat monitoring...
2025-03-06 00:09:14,116 - INFO - Starting heartbeat monitor thread.
2025-03-06 00:09:14,117 - INFO - Heartbeat monitoring started.
2025-03-06 00:09:14,117 - INFO - Scheduled production message for equipment 1 every 2 minutes.
2025-03-06 00:09:14,117 - INFO - Starting MQTT client loop...
2025-03-06 00:09:14,156 - INFO - Initialized heartbeat tracking for MAQ01.
2025-03-06 00:09:15,157 - INFO - Configuration updated for MAQ01. New cycle = 2 minute(s)
2025-03-06 00:09:25,174 - ERROR - ALARM TRIGGERED: Heartbeat timeout for MAQ01. Elapsed = 11.02s, Timeout = 11s
2025-03-06 00:09:25,175 - WARNING - PLC client connection failed.
2025-03-06 00:09:25,175 - ERROR - Failed to connect to PLC. Cannot write alarm data.
2025-03-06 00:09:25,175 - WARNING - Alarm written to PLC for MAQ01: Byte 8, Bit 0, Value 1
2025-03-06 00:11:14,128 - INFO - Building production count message for equipment 'MAQ01'
2025-03-06 00:11:14,418 - WARNING - No counter records found for equipment output ID '1', returning 0.
2025-03-06 00:11:14,418 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-06 00:11:14,419 - INFO - Sent production message for equipment 1.
2025-03-06 00:13:14,423 - INFO - Building production count message for equipment 'MAQ01'
2025-03-06 00:13:14,428 - WARNING - No counter records found for equipment output ID '1', returning 0.
2025-03-06 00:13:14,429 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-06 00:13:14,429 - INFO - Sent production message for equipment 1.
2025-03-06 00:13:47,145 - INFO - Initializing MQTT connection...
2025-03-06 00:13:47,380 - INFO - Starting periodic message service...
2025-03-06 00:13:47,400 - INFO - Started periodic message sending thread.
2025-03-06 00:13:47,405 - INFO - Starting heartbeat monitoring...
2025-03-06 00:13:47,405 - INFO - Starting heartbeat monitor thread.
2025-03-06 00:13:47,406 - INFO - Heartbeat monitoring started.
2025-03-06 00:13:47,407 - INFO - Scheduled production message for equipment 1 every 2 minutes.
2025-03-06 00:13:47,407 - INFO - Starting MQTT client loop...
2025-03-06 00:13:47,446 - INFO - Initialized heartbeat tracking for MAQ01.
2025-03-06 00:13:48,449 - INFO - Configuration updated for MAQ01. New cycle = 2 minute(s)
2025-03-06 00:15:47,414 - INFO - Building production count message for equipment 'MAQ01'
2025-03-06 00:15:47,892 - WARNING - No counter records found for equipment output ID '1', returning 0.
2025-03-06 00:15:47,893 - WARNING - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-06 00:15:47,893 - INFO - Sent ProductionCount message to 'NAU/CRK/GTW003/BE' (Size: 188 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": [{"outputCode": "OUT01", "value": 0}]}
2025-03-06 00:15:47,893 - INFO - Sent production message for equipment 1.
2025-03-06 00:16:13 - INFO - MESMain - Initializing MQTT connection...
2025-03-06 00:16:13 - INFO - MESMain - Starting periodic message service...
2025-03-06 00:16:13 - INFO - MQTT.mqtt_message_processor - Started periodic message sending thread.
2025-03-06 00:16:13 - INFO - MESMain - Starting heartbeat monitoring...
2025-03-06 00:16:13 - INFO - MQTT.mqtt_heart_beat - Starting heartbeat monitor thread.
2025-03-06 00:16:13 - INFO - MQTT.mqtt_heart_beat - Heartbeat monitoring started.
2025-03-06 00:16:13 - INFO - service.message_service - Scheduled production message for equipment 1 every 2 minutes.
2025-03-06 00:16:13 - INFO - MESMain - Starting MQTT client loop...
2025-03-06 00:16:13 - INFO - MQTT.mqtt_heart_beat - Initialized heartbeat tracking for MAQ01.
2025-03-06 00:16:14 - INFO - MQTT.mqtt_heart_beat - Configuration updated for MAQ01. New cycle = 2 minute(s)
2025-03-06 00:18:13 - INFO - service.production_count_service - Building production count message for equipment 'MAQ01'
2025-03-06 00:18:14 - WARNING - service.counter_record_service - No counter records found for equipment output ID '1', returning 0.
2025-03-06 00:18:14 - WARNING - service.production_count_service - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-06 00:18:14 - ERROR - service.message_service - Error while sending message response: 'MessageService' object has no attribute '_serialize_message'
Traceback (most recent call last):
  File "C:\Users\Antonio Melo\Documents\MESCloud\GTW\GTWMES\app\service\message_service.py", line 80, in _send_message_response
    serialized_message = json.dumps(data, default=self._serialize_message)
                                                  ^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'MessageService' object has no attribute '_serialize_message'
2025-03-06 00:18:14 - INFO - service.message_service - Sent production message for equipment 1.
2025-03-06 00:18:30 - INFO - MESMain - Initializing MQTT connection...
2025-03-06 00:18:30 - INFO - MESMain - Starting periodic message service...
2025-03-06 00:18:30 - INFO - MQTT.mqtt_message_processor - Started periodic message sending thread.
2025-03-06 00:18:30 - INFO - MESMain - Starting heartbeat monitoring...
2025-03-06 00:18:30 - INFO - MQTT.mqtt_heart_beat - Starting heartbeat monitor thread.
2025-03-06 00:18:30 - INFO - MQTT.mqtt_heart_beat - Heartbeat monitoring started.
2025-03-06 00:18:30 - INFO - service.message_service - Scheduled production message for equipment 1 every 1 minutes.
2025-03-06 00:18:30 - INFO - MESMain - Starting MQTT client loop...
2025-03-06 00:18:30 - INFO - MQTT.mqtt_heart_beat - Initialized heartbeat tracking for MAQ01.
2025-03-06 00:18:31 - INFO - MQTT.mqtt_heart_beat - Configuration updated for MAQ01. New cycle = 1 minute(s)
2025-03-06 00:19:30 - INFO - service.production_count_service - Building production count message for equipment 'MAQ01'
2025-03-06 00:19:31 - WARNING - service.counter_record_service - No counter records found for equipment output ID '1', returning 0.
2025-03-06 00:19:31 - WARNING - service.production_count_service - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-06 00:19:31 - INFO - service.message_service - Sent ProductionCount message to 'NAU/CRK/GTW003/BE' (Size: 188 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": [{"outputCode": "OUT01", "value": 0}]}
2025-03-06 00:19:31 - INFO - service.message_service - Sent production message for equipment 1.
2025-03-06 00:20:31 - INFO - service.production_count_service - Building production count message for equipment 'MAQ01'
2025-03-06 00:20:31 - WARNING - service.counter_record_service - No counter records found for equipment output ID '1', returning 0.
2025-03-06 00:20:31 - WARNING - service.production_count_service - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-06 00:20:31 - INFO - service.message_service - Sent ProductionCount message to 'NAU/CRK/GTW003/BE' (Size: 188 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": [{"outputCode": "OUT01", "value": 0}]}
2025-03-06 00:20:31 - INFO - service.message_service - Sent production message for equipment 1.
2025-03-06 00:21:11 - INFO - MESMain - Initializing MQTT connection...
2025-03-06 00:21:11 - INFO - MESMain - Starting periodic message service...
2025-03-06 00:21:11 - INFO - MQTT.mqtt_message_processor - Started periodic message sending thread.
2025-03-06 00:21:11 - INFO - MESMain - Starting heartbeat monitoring...
2025-03-06 00:21:11 - INFO - MQTT.mqtt_heart_beat - Starting heartbeat monitor thread.
2025-03-06 00:21:11 - INFO - MQTT.mqtt_heart_beat - Heartbeat monitoring started.
2025-03-06 00:21:11 - INFO - MESMain - Starting MQTT client loop...
2025-03-06 00:21:11 - INFO - service.message_service - Scheduled production message for equipment 1 every 1 minutes.
2025-03-06 00:21:11 - INFO - MQTT.mqtt_heart_beat - Initialized heartbeat tracking for MAQ01.
2025-03-06 00:21:12 - INFO - MQTT.mqtt_heart_beat - Configuration updated for MAQ01. New cycle = 1 minute(s)
2025-03-06 00:22:11 - INFO - service.production_count_service - Building production count message for equipment 'MAQ01'
2025-03-06 00:22:11 - WARNING - service.counter_record_service - No counter records found for equipment output ID '1', returning 0.
2025-03-06 00:22:11 - WARNING - service.production_count_service - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-06 00:22:11 - INFO - service.message_service - SENT ProductionCount MESSAGE TO 'NAU/CRK/GTW003/BE' (Size: 188 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": [{"outputCode": "OUT01", "value": 0}]}
2025-03-06 00:22:11 - INFO - service.message_service - Sent production message for equipment 1.
2025-03-06 00:23:11 - INFO - service.production_count_service - Building production count message for equipment 'MAQ01'
2025-03-06 00:23:11 - WARNING - service.counter_record_service - No counter records found for equipment output ID '1', returning 0.
2025-03-06 00:23:11 - WARNING - service.production_count_service - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-06 00:23:11 - INFO - service.message_service - SENT ProductionCount MESSAGE TO 'NAU/CRK/GTW003/BE' (Size: 188 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": [{"outputCode": "OUT01", "value": 0}]}
2025-03-06 00:23:11 - INFO - service.message_service - Sent production message for equipment 1.
2025-03-06 00:24:11 - INFO - service.production_count_service - Building production count message for equipment 'MAQ01'
2025-03-06 00:24:11 - WARNING - service.counter_record_service - No counter records found for equipment output ID '1', returning 0.
2025-03-06 00:24:11 - WARNING - service.production_count_service - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-06 00:24:11 - INFO - service.message_service - SENT ProductionCount MESSAGE TO 'NAU/CRK/GTW003/BE' (Size: 188 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": [{"outputCode": "OUT01", "value": 0}]}
2025-03-06 00:24:11 - INFO - service.message_service - Sent production message for equipment 1.
2025-03-06 00:24:16 - ERROR - MQTT.mqtt_heart_beat - ALARM TRIGGERED: Heartbeat timeout for MAQ01. Elapsed = 185.22s, Timeout = 185s
2025-03-06 00:24:16 - WARNING - service.plc_service - PLC client connection failed.
2025-03-06 00:24:16 - ERROR - service.plc_service - Failed to connect to PLC. Cannot write alarm data.
2025-03-06 00:24:16 - WARNING - MQTT.mqtt_heart_beat - Alarm written to PLC for MAQ01: Byte 8, Bit 0, Value 1
2025-03-06 00:25:11 - INFO - service.production_count_service - Building production count message for equipment 'MAQ01'
2025-03-06 00:25:11 - WARNING - service.counter_record_service - No counter records found for equipment output ID '1', returning 0.
2025-03-06 00:25:11 - WARNING - service.production_count_service - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-06 00:25:11 - INFO - service.message_service - SENT ProductionCount MESSAGE TO 'NAU/CRK/GTW003/BE' (Size: 188 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": [{"outputCode": "OUT01", "value": 0}]}
2025-03-06 00:25:11 - INFO - service.message_service - Sent production message for equipment 1.
2025-03-06 00:26:11 - INFO - service.production_count_service - Building production count message for equipment 'MAQ01'
2025-03-06 00:26:11 - WARNING - service.counter_record_service - No counter records found for equipment output ID '1', returning 0.
2025-03-06 00:26:11 - WARNING - service.production_count_service - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-06 00:26:11 - INFO - service.message_service - SENT ProductionCount MESSAGE TO 'NAU/CRK/GTW003/BE' (Size: 188 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": [{"outputCode": "OUT01", "value": 0}]}
2025-03-06 00:26:11 - INFO - service.message_service - Sent production message for equipment 1.
2025-03-06 00:27:11 - INFO - service.production_count_service - Building production count message for equipment 'MAQ01'
2025-03-06 00:27:11 - WARNING - service.counter_record_service - No counter records found for equipment output ID '1', returning 0.
2025-03-06 00:27:11 - WARNING - service.production_count_service - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-06 00:27:11 - INFO - service.message_service - SENT ProductionCount MESSAGE TO 'NAU/CRK/GTW003/BE' (Size: 188 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": [{"outputCode": "OUT01", "value": 0}]}
2025-03-06 00:27:11 - INFO - service.message_service - Sent production message for equipment 1.
2025-03-06 00:28:11 - INFO - service.production_count_service - Building production count message for equipment 'MAQ01'
2025-03-06 00:28:11 - WARNING - service.counter_record_service - No counter records found for equipment output ID '1', returning 0.
2025-03-06 00:28:11 - WARNING - service.production_count_service - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-06 00:28:11 - INFO - service.message_service - SENT ProductionCount MESSAGE TO 'NAU/CRK/GTW003/BE' (Size: 188 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": [{"outputCode": "OUT01", "value": 0}]}
2025-03-06 00:28:11 - INFO - service.message_service - Sent production message for equipment 1.
2025-03-06 00:29:11 - INFO - service.production_count_service - Building production count message for equipment 'MAQ01'
2025-03-06 00:29:11 - WARNING - service.counter_record_service - No counter records found for equipment output ID '1', returning 0.
2025-03-06 00:29:11 - WARNING - service.production_count_service - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-06 00:29:11 - INFO - service.message_service - SENT ProductionCount MESSAGE TO 'NAU/CRK/GTW003/BE' (Size: 188 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": [{"outputCode": "OUT01", "value": 0}]}
2025-03-06 00:29:11 - INFO - service.message_service - Sent production message for equipment 1.
2025-03-06 00:30:11 - INFO - service.production_count_service - Building production count message for equipment 'MAQ01'
2025-03-06 00:30:11 - WARNING - service.counter_record_service - No counter records found for equipment output ID '1', returning 0.
2025-03-06 00:30:11 - WARNING - service.production_count_service - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-06 00:30:11 - INFO - service.message_service - SENT ProductionCount MESSAGE TO 'NAU/CRK/GTW003/BE' (Size: 188 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": [{"outputCode": "OUT01", "value": 0}]}
2025-03-06 00:30:11 - INFO - service.message_service - Sent production message for equipment 1.
2025-03-06 00:30:36 - INFO - MESMain - Initializing MQTT connection...
2025-03-06 00:30:36 - INFO - MESMain - Starting periodic message service...
2025-03-06 00:30:37 - INFO - MQTT.mqtt_message_processor - Started periodic message sending thread.
2025-03-06 00:30:37 - INFO - MESMain - Starting heartbeat monitoring...
2025-03-06 00:30:37 - INFO - MQTT.mqtt_heart_beat - Starting heartbeat monitor thread.
2025-03-06 00:30:37 - INFO - MQTT.mqtt_heart_beat - Heartbeat monitoring started.
2025-03-06 00:30:37 - INFO - service.message_service - Scheduled production message for equipment 1 every 1 minutes.
2025-03-06 00:30:37 - INFO - MESMain - Starting MQTT client loop...
2025-03-06 00:30:37 - INFO - MQTT.mqtt_heart_beat - Initialized heartbeat tracking for MAQ01.
2025-03-06 00:30:38 - INFO - MQTT.mqtt_heart_beat - Configuration updated for MAQ01. New cycle = 1 minute(s)
2025-03-06 00:31:37 - INFO - service.production_count_service - Building production count message for equipment 'MAQ01'
2025-03-06 00:31:37 - WARNING - service.counter_record_service - No counter records found for equipment output ID '1', returning 0.
2025-03-06 00:31:37 - WARNING - service.production_count_service - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-06 00:31:37 - INFO - service.message_service - Sent ProductionCount message to 'NAU/CRK/GTW003/BE' (Size: 188 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": [{"outputCode": "OUT01", "value": 0}]}
2025-03-06 00:31:37 - INFO - service.message_service - Sent production message for equipment 1.
2025-03-06 00:32:37 - INFO - service.production_count_service - Building production count message for equipment 'MAQ01'
2025-03-06 00:32:37 - WARNING - service.counter_record_service - No counter records found for equipment output ID '1', returning 0.
2025-03-06 00:32:37 - WARNING - service.production_count_service - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-06 00:32:37 - INFO - service.message_service - Sent ProductionCount message to 'NAU/CRK/GTW003/BE' (Size: 188 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": [{"outputCode": "OUT01", "value": 0}]}
2025-03-06 00:32:37 - INFO - service.message_service - Sent production message for equipment 1.
2025-03-06 00:33:37 - INFO - service.production_count_service - Building production count message for equipment 'MAQ01'
2025-03-06 00:33:37 - WARNING - service.counter_record_service - No counter records found for equipment output ID '1', returning 0.
2025-03-06 00:33:37 - WARNING - service.production_count_service - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-06 00:33:37 - INFO - service.message_service - Sent ProductionCount message to 'NAU/CRK/GTW003/BE' (Size: 188 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": [{"outputCode": "OUT01", "value": 0}]}
2025-03-06 00:33:37 - INFO - service.message_service - Sent production message for equipment 1.
2025-03-06 00:33:42 - ERROR - MQTT.mqtt_heart_beat - ALARM TRIGGERED: Heartbeat timeout for MAQ01. Elapsed = 185.22s, Timeout = 185s
2025-03-06 00:33:42 - WARNING - service.plc_service - PLC client connection failed.
2025-03-06 00:33:42 - ERROR - service.plc_service - Failed to connect to PLC. Cannot write alarm data.
2025-03-06 00:33:42 - WARNING - MQTT.mqtt_heart_beat - Alarm written to PLC for MAQ01: Byte 8, Bit 0, Value 1
2025-03-06 00:34:37 - INFO - service.production_count_service - Building production count message for equipment 'MAQ01'
2025-03-06 00:34:37 - WARNING - service.counter_record_service - No counter records found for equipment output ID '1', returning 0.
2025-03-06 00:34:37 - WARNING - service.production_count_service - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-06 00:34:37 - INFO - service.message_service - Sent ProductionCount message to 'NAU/CRK/GTW003/BE' (Size: 188 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": [{"outputCode": "OUT01", "value": 0}]}
2025-03-06 00:34:37 - INFO - service.message_service - Sent production message for equipment 1.
2025-03-06 00:35:37 - INFO - service.production_count_service - Building production count message for equipment 'MAQ01'
2025-03-06 00:35:37 - WARNING - service.counter_record_service - No counter records found for equipment output ID '1', returning 0.
2025-03-06 00:35:37 - WARNING - service.production_count_service - Could not fetch equipment status for 'MAQ01', defaulting to 0
2025-03-06 00:35:37 - INFO - service.message_service - Sent ProductionCount message to 'NAU/CRK/GTW003/BE' (Size: 188 bytes): {"jsonType": "ProductionCount", "equipmentCode": "MAQ01", "productionOrderCode": "", "equipmentStatus": 0, "activeTime": 0, "alarms": [], "counters": [{"outputCode": "OUT01", "value": 0}]}
2025-03-06 00:35:37 - INFO - service.message_service - Sent production message for equipment 1.
